<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../assets/usage.css">
  <title>Transformations -- ImageMagick Examples</title>
  <link rel="icon" href="../img_www/favicon.ico" type="image/x-icon">
  <link rel="shortcut" href="../img_www/favicon.ico" type="image/x-icon">
  <link rel="canonical" href="https://usage.imagemagick.org/transform/">
</head>
<body>
  <main class="container">
    <div class="magick-template">
      <div class="magick-header">
        <h1>ImageMagick Examples --<br>
        <img src="../img_www/space.gif" width="50" height="1"> Image Transformations</h1>
        <div>
          <dl>
            <dt><b>Index</b></dt>
            <dt>
              <a href="../"><img src="../img_www/granitesm_left.gif" border="0" width="15" height="15"> ImageMagick Examples Preface and Index</a>
            </dt>
            <dd>
              <a href="#art"><img src="../img_www/granitesm_right.gif" border="0" width="15" height="15"> Art-like Transformations</a>
              <ul>
                <li>
                  <a href="#raise">Turn images into raised or sunken buttons</a>
                </li>
                <li>
                  <a href="#inside_border">Adding an Inside Border</a>
                </li>
                <li>
                  <a href="#spread">Random Pixel Spread</a>
                </li>
                <li>
                  <a href="#vignette">Vignette photo transform</a>
                </li>
                <li>
                  <a href="#polaroid">Complex Polaroid Transform</a>
                </li>
                <li>
                  <a href="#paint">Oil Painting, blobs of color</a>
                </li>
                <li>
                  <a href="#charcoal">Charcoal, artists sketch of a scene</a>
                </li>
                <li>
                  <a href="#sketch">Pencil Sketch Transform</a>
                </li>
                <li>
                  <a href="#emboss">Emboss, creating a metallic impression</a>
                </li>
                <li>
                  <a href="#stegano">Stegano, hiding a secrets within an image</a>
                </li>
                <li>
                  <a href="#encipher">Encrypting Image Data</a>
                </li>
                <li>
                  <a href="#pixelate">Pixelate Images</a>
                </li>
                <li>
                  <a href="#gridding">Grids of Pixels</a>
                </li>
                <li>
                  <a href="#spacing_tiles">Spacing out Tiles</a>
                </li>
              </ul>
            </dd>
            <dd>
              <a href="#vision"><img src="../img_www/granitesm_right.gif" border="0" width="15" height="15"> Computer Vision Transformations</a>
              <ul>
                <li>
                  <a href="#edge">Edge Detection</a>
                </li>
                <li>
                  <a href="#canny">Canny Edge Detector</a>
                </li>
                <li>
                  <a href="#edge_jitter">Edge Outlines from Anti-Aliased Shapes</a>
                </li>
                <li>
                  <a href="#edge_bitmap">Edge Outlines from Bitmap Shapes</a>
                </li>
                <li>
                  <a href="#edge_vector">Edging Using a Raster to Vector Converter</a>
                </li>
                <li>
                  <a href="#hough">Hough Line Detector</a>
                </li>
                <li>
                  <a href="#lat">Local Adaptive Thresholding (lat)</a>
                </li>
              </ul>
            </dd>
            <dd>
              <a href="#shade"><img src="../img_www/granitesm_right.gif" border="0" width="15" height="15"> Shade 3D Highlighting</a>
              <ul>
                <li>
                  <a href="#shade">Using Shade</a>
                </li>
                <li>
                  <a href="#shade_mask">Masked Shaded Shapes</a>
                </li>
                <li>
                  <a href="#shade_shape">Shaded Shape Images</a>
                </li>
                <li>
                  <a href="#shade_blur">Rounding Shade Edges</a>
                </li>
                <li>
                  <a href="#shade_overlay">Creating Overlay Highlights</a>
                </li>
                <li>
                  <a href="#shade_highlight">Using a Dawn Shade Highlight</a>
                </li>
              </ul>
            </dd>
            <dd>
              <a href="#fx"><img src="../img_www/granitesm_right.gif" border="0" width="15" height="15"> Using FX, the DIY Image Operator</a>
              <ul>
                <li>
                  <a href="#fx">FX Basic Usage</a>
                </li>
                <li>
                  <a href="#fx_escapes">FX Expressions as Percent Escapes</a>
                </li>
                <li>
                  <a href="#fx_builtins">FX-like Built-in Methods</a>
                </li>
                <li>
                  <a href="#fx_other">Accessing data from other images</a>
                </li>
              </ul>
            </dd>
            <dd>
              <a href="#evaluate"><img src="../img_www/granitesm_right.gif" border="0" width="15" height="15"> Evaluate and Function, Fast FX Operators</a>
              <ul>
                <li>
                  <a href="#evaluate">Evaluate, Simple Math Operations</a>
                  <dl>
                    <dd>
                      <a href="#evaluate_set">Set</a>,&nbsp; <a href="#evaluate_add">Add</a>,&nbsp; <a href="#evaluate_subtract">Subtract</a>,&nbsp; <a href="#evaluate_multiply">Multiply</a>,&nbsp; <a href="#evaluate_divide">Divide</a>
                    </dd>
                  </dl>
                </li>
                <li>
                  <a href="#evaluate_math">Evaluate Math Functions</a>
                  <dl>
                    <dd>
                      <a href="#evaluate_pow">Pow</a>,&nbsp; <a href="#evaluate_log">Log</a>,&nbsp; <a href="#evaluate_sin">Sin</a>,&nbsp; <a href="#evaluate_cos">Cos</a>
                    </dd>
                  </dl>
                </li>
                <li>
                  <a href="#function">Function, Multi-Argument Evaluate</a>
                  <dl>
                    <dd>
                      <a href="#function_polynomial">Polynomial</a>,&nbsp; <a href="#function_sinusoid">Sinusoid</a>,&nbsp; <a href="#function_arcsin">ArcSin</a>,&nbsp; <a href="#function_arctan">ArcTan</a>
                    </dd>
                  </dl>
                </li>
              </ul>
            </dd>
            <dd>
              <a href="#gradient_math"><img src="../img_www/granitesm_right.gif" border="0" width="15" height="15">Mathematics on Gradients</a>
              <ul>
                <li>
                  <a href="#math_attenuate">Attenuate a Biased Gradients</a>
                </li>
                <li>
                  <a href="#math_multiply">Multiply Biased Gradients</a>
                </li>
                <li>
                  <a href="#math_addition">Adding Biased Gradients</a>
                </li>
                <li>
                  <a href="#math_freq_mod">Frequency Modulation</a>
                </li>
              </ul>
            </dd>
          </dl>These operations produce major changes to the overall appearance of the image either for visual, or art-like effects. However while the overall look of the image has changed, often dramatically, the original image itself is still generally visible in the result.
          <hr>
          <!-- ---------------------------------------------------------------- -->
          <a name="art" id="art"></a>
          <h2>Art-Like Transformations</h2><a name="raise" id="raise"></a>
          <h3>Raise or Sunk Borders</h3>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#raise">-raise</a></code>" operator is such a simple image transformation, that it almost isn't. All it does is as a rectangular bevel highlight to an existing image.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -raise 5  rose_raise.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_raise.gif"><img src="rose_raise.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>An inverted sunken effect can be generated using the 'plus' form of the operator...
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: +raise 5  rose_sunken.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_sunken.gif"><img src="rose_sunken.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>This operator is a bit like <a href="../crop/#frame">Framing</a> an image, but instead of adding extra pixels as a border, the "<code><a href="https://imagemagick.org/script/command-line-options.php?#raise">-raise</a></code>" operator re-colors the edge pixels of the image. This makes it an image transform.
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/expert.gif" width="23" height="26"><img src="../img_www/space.gif" width="17" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>In actual fact <a href="../crop/#frame">Image Framing</a> is achieved by adding a Border, then raising it!</i></font></td>
            </tr>
          </table>
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>The operator only works on rectangular images, and will fail for images with a transparent background, as the color modifications will also be transparent. Basically is it a rather dumb operator!</i></font></td>
            </tr>
          </table><a name="inside_border" id="inside_border"></a>
          <h3>Adding an Inside Border</h3>Instead of placing a border around the outside of the image, the user wanted to overlay a border directly onto the edges of the image itself. To achieve this effect, the solution was to draw a rectangle that aligns precisely with the image's dimensions. Since the built-in "rose" image measures 70×46 pixels, the resulting overlay matches those dimensions exactly.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -fill none -stroke navy -strokewidth 11  \
          -draw 'rectangle 0,0 69,45'   inside_border.jpg
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="inside_border.jpg"><img src="inside_border.jpg" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>The width of the border added is controlled by the "<code><a href="https://imagemagick.org/script/command-line-options.php?#strokewidth">-strokewidth</a></code>" of the rectangle. That is
          <div align="center">
            <pre>{stroke width}  =  {border width} * 2 - 1</pre>
          </div>As such the above 6 pixel border needed a "<code><a href="https://imagemagick.org/script/command-line-options.php?#strokewidth">-strokewidth</a></code>" of 11. If you don't know the size of the image, then you can <a href="../crop/#shave">Shave</a> the image then add the <a href="../crop/#border">Border</a> as normal. This is probably easier, though prehaps not as versatile.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -bordercolor green -shave 6x6 -border 6x6 inside_border2.jpg
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="inside_border2.jpg"><img src="inside_border2.jpg" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table><a name="spread" id="spread"></a>
          <h3>Random Pixel Spread</h3>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#spread">-spread</a></code>" would replace each pixel the color of a random nearby color from the source image. This random selection was made as per the use of <a href="../misc/#interpolate">Pixel Interpolation</a> and <a href="../misc/#virtual-pixel">Virtual-Pixel Setting</a>.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                For example...
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" replace="">
  magick -size 80x40 xc:red xc:blue -append -spread 5 spread_interpolated.png
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="spread_interpolated.png"><img src="spread_interpolated.png" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>If you were to examine the pixels image you will see that some pixels may have a mix of red and blue colors. That is, they are interpolated, not simply spread or swapped. This is more pronounce smaller distance values.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                Also note that "<code><a href="https://imagemagick.org/script/command-line-options.php?#spread">-spread</a></code>" also makes use of the <a href="../misc/#virtual-pixel">Virtual-Pixel Setting</a>.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" replace="">
  magick -size 80x80 xc: -virtual-pixel black -spread 10 spread_virtual.png
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="spread_virtual.png"><img src="spread_virtual.png" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>As you can see you get a randomized border, mostly of pure black virtual pixels Though there are a few grey pixels interpolated from the border between the real pixels of the image and virtual pixels. To get a more traditional spread pixels effect, you can prevent this color mixing by forcing the color lookup of specific pixels by using "<code><a href="https://imagemagick.org/script/command-line-options.php?#interpolate">-interpolate</a> <a href="../misc/#nearest">Nearest</a></code>". To avoid the problems with virtual pixels and posible 'edge color bias', I recommend you use "<code><a href="https://imagemagick.org/script/command-line-options.php?#virtual-pixel">-virtual-pixel</a> <a href="../misc/#mirror">Mirror</a></code>". As such this is a more traditonal random 'spread' of pixels...
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" replace="">
  magick rose: -interpolate nearest -virtual-pixel mirror \
                -spread 5   spread_rose.png
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="spread_rose.png"><img src="spread_rose.png" width="70" height="46" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table><br>
          <div align="center">
            <font size="+2"><b><img src="../img_www/const_barrier.gif" width="39" height="35" align="top"> Under Construction <img src="../img_www/const_hole.gif" width="144" height="50" align="middle"></b></font>
          </div>The main problem with the above is that you can lose some pixel data from the image. That is, the pixels are not 'swapped' but randomally copied, which means a specific pixel in the image may become duplicated or lost. As of IM v6.9.2-2 you can use "<code><a href="https://imagemagick.org/script/command-line-options.php?#spread">+spread</a></code>" to actually swap pixels within the image, meaning that no pixel in the image will be duplicated or lost. Every pixel in the original image is still present, just displaced to to new location.However due to the way pixels are processed, pixels may be 'double-swapped'. That is, a specific pixel may be swapped, but then selected to be swapped again with a later pixel. That means a specific pixel could drift further than was requested by the spread argument. This double swapping also mean that pixels were likely to spread further toward the lower right corner. That movement is of course balanced but a smaller drift of a large number of pixels toward the upper-left.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                For example, here I spread pixels with the original prepended as a referance.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" replace="">
  magick -size 40x40 xc:red xc:blue -append \
          \( +clone +spread 5 \) +append spread_bias.png
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="spread_bias.png"><img src="spread_bias.png" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Note how some red pixels are spread downward more, though you also get a few blue pixels spreading upward more than expected too ( though toward the left side of the image). This problem is more pronounce when you use a smaller distance argument to spread. A solution to this double-swap problem is not easy, and we are looking for a 'limited area shuffle' algorithm to solve it. But in the mean time you can at least mitigate the directional bias by doing the spread twice, with a the <a href="../warping/#transverse">Transverse</a> (top-left to bottom right diagonal mirror) distortion.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" replace="">
  magick -size 40x40 xc:red xc:blue -append \
          \( +clone +spread 5 -transverse -spread 5 -transverse \) \
          +append spread_no_bias.png
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="spread_no_bias.png"><img src="spread_no_bias.png" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Of course this does makes the spread more pronounced, and less linear, but at least it is without a directional bias, or pixel duplication/loss. The above addition was developed from a Forum Discussion: t=28043 IM Forum Discussion <a href="https://magick.imagemagick.org/viewtopic.php?f=2&amp;t=28043">rearrange vertical pixel row</a> . <a name="vignette" id="vignette"></a>
          <h3>Vignette Photo Transform</h3>A special operator to make an image circular with a soft blurry outline.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -background black -vignette 0x5  rose_vignette.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_vignette.gif"><img src="rose_vignette.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>By using a zero (or very small) sigma you can remove the blur, and generate ellipse or oval frames. However note that it does not actually use the largest ellipse posible, so you may want to DIY it.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -background black -vignette 0x0  rose_vignette_0.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_vignette_0.gif"><img src="rose_vignette_0.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>You can use it with transparency (and PNG format)...
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -alpha Set -background none -vignette 0x3  rose_vignette.png
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_vignette.png"><img src="rose_vignette.png" align="middle" vspace="5" hspace="5" border="0" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>An alternative argument method is to use a very large number for the second <i>sigma</i> component, and then use the first <i>radius</i> to define the spread of the blur. This produces a 'linear' distribution rather than a more common Gaussian distribution to the vignette blurring.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -background black -vignette 5x65000  rose_vignette_linear.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_vignette.gif"><img src="rose_vignette.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Another technique for a more rectangular vignette, producing soft edges to the image is demonstrated in <a href="../thumbnails/#soft_edges">Thumbnails with Soft Edges</a>. <a name="polaroid" id="polaroid"></a>
          <h3>Complex Polaroid Transformation</h3>Thanks to the work done by Timothy Hunter, (of RMagick fame), a "<code><a href="https://imagemagick.org/script/command-line-options.php?#polaroid">-polaroid</a></code>" transformation operator, was added to IM v6.3.2.
          <div align="right">
            <font size="-2">Polaroid® is a registered trademark of the Polaroid Corporation.</font>
          </div>
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                For example, here I give a polaroid look to a photo thumbnail. The image is looking up the <a href="../img_photos/spiral_stairs_sm.jpg">spiral staircase (downward), inside the Arc de Triumph, Paris</a>. It is a very long staircase!.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" random="">
  magick spiral_stairs_sm.jpg -thumbnail 120x120 \
          -bordercolor white -background black  +polaroid  poloroid.png
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="poloroid.png"><img src="poloroid.png" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>Note the resulting image has a semi-transparent shadow, so you either have to use a PNG format image, or "<code><a href="https://imagemagick.org/script/command-line-options.php?#flatten">-flatten</a></code>" the result onto a fixed background color for GIF or JPG formats.</i></font></td>
            </tr>
          </table>This operator is very complex, as it adds border (as per the "<code><a href="https://imagemagick.org/script/command-line-options.php?#bordercolor">-bordercolor</a></code>" setting), 'curls' the paper, and adds an inverse curl to the shadow. The shadow color can be controlled by the "<code><a href="https://imagemagick.org/script/command-line-options.php?#background">-background</a></code>" color setting. As you saw above the plus form of the operator will rotate the result by a random amount. This operator makes a <a href="../img_photos/INDEX.html">Index of Photos</a> much more interesting and less static than you would otherwise get.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                The minus form of the operator lets you control the angle of rotation of the image.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick spiral_stairs_sm.jpg -thumbnail 120x120 \
          -bordercolor AliceBlue -background SteelBlue4 -polaroid 5 \
          poloroid_5.png
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="poloroid_5.png"><img src="poloroid_5.png" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                If the image has "<code><a href="https://imagemagick.org/script/command-line-options.php?#caption">-caption</a></code>" meta-data, that text will also be added into the lower border of the polaroid frame, via the "<code><a href="../text/#caption">caption:</a></code>" image creation operator. That is, it will be word wrapped to the width of the photo.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" random="">
  magick -caption '%c %f\n%wx%h' spiral_stairs_sm.jpg -thumbnail 120x120 \
          -bordercolor Lavender  -background gray40  +polaroid \
          poloroid_captioned.png
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="poloroid_captioned.png"><img src="poloroid_captioned.png" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                The other standard text settings (as per "<code><a href="../text/#caption">caption:</a></code>"), allows you to control the look of the added caption.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick spiral_stairs_sm.jpg -thumbnail 120x120 -font Candice -pointsize 18 \
          -bordercolor Snow -background black -fill dodgerblue -stroke navy \
          -gravity center  -set caption "Spiral Stairs\!"  -polaroid 10 \
          poloroid_controls.png
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="poloroid_controls.png"><img src="poloroid_controls.png" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/expert.gif" width="23" height="26"><img src="../img_www/space.gif" width="17" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>The image meta-data attribute "<code><a href="https://imagemagick.org/script/command-line-options.php?#caption">-caption</a></code>" was used due to the internal use of "<code><a href="../text/#caption">caption:</a></code>" text to image generator.<br>
              <br>
              On the other hand the IM command "<code><a href="../montage/#montage">montage</a></code>" uses "<code><a href="https://imagemagick.org/script/command-line-options.php?#label">-label</a></code>" as it uses the non-word wrapping "<code><a href="../text/#label">label:</a></code>" text to image generator.</i></font></td>
            </tr>
          </table>The transforms use of <a href="../warping/#rotate">Rotate</a> and <a href="../warping/#wave">Wave</a> shearing distortions to add a little 'curl' to the photo image has a tendency to produce horizontal lines of fuzziness in text of the image generated. This is a well known <a href="../distorts/summery">Image Distortion</a> problem (see <a href="../warping/#rotate_line">Rotating a Thin Line</a>), and one that can be solved by using a <a href="../distorts/#super_sampling">super sampling</a> technique. Basically we generate the polaroid twice as large as what we really want, then we just resize the image to its final normal size. The reduction in the image size effectively sharpens the resulting image, and more importantly the caption text. However to make this work we not only need an image at least twice the final size, but also we may need to a larger border to the image, and draw the text at twice its normal "<code><a href="https://imagemagick.org/script/command-line-options.php?#density">-density</a></code>". Do not increase the fonts "<code><a href="https://imagemagick.org/script/command-line-options.php?#pointsize">-pointsize</a></code>" as that does not enlarge the text in quite the same way.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -caption 'Spiral Staircase, Arc de Triumph, Paris, April 2006' \
          spiral_stairs_sm.jpg  -thumbnail 240x240 \
          -bordercolor Lavender -border 5x5   -density 144  \
          -gravity center  -pointsize 8   -background black \
          -polaroid -15     -resize 50%     poloroid_modified.png
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="poloroid_modified.png"><img src="poloroid_modified.png" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>As you can see, even though we used a much smaller font pointsize, the caption text is very sharp, clear and readable. The same for any other fine detail that may have been present in the original image. The only disadvantage of this is that the shadow of the resulting image will be smaller, and less fuzzy. For total control of the polaroid transformation, you can do all the steps involved yourself. The original technique documented on Tim Hunter's page, <a href="http://rmagick.rubyforge.org/Polaroid/polaroid.html">RMagick Polaroid Effect</a>. The steps are: create and append caption, add borders, curl photo with wave, add a reversed curled shadow, and finally rotate image. For more examples, and other DIY methods, see <a href="../thumbnails/#polaroid">Polaroid Thumbnail Examples</a>, and <a href="../montage/#polaroid">A Montage of Polaroid Photos</a>. You may also be interested in some of the polaroid examples in <a href="http://rubblewebs.co.uk/imagemagick/other.php">RubbleWeb IM Examples, Other</a>. <a name="paint" id="paint"></a>
          <h3>Oil Painting, blobs of color</h3>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#paint">-paint</a></code>" operator is designed to magick pictures into paintings made by applying thick 'blobs' of paint to a canvas. The result is a merging of neighbourhood colors into larger single color areas.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -paint 1   rose_paint_1.gif
  magick rose: -paint 3   rose_paint_3.gif
  magick rose: -paint 5   rose_paint_5.gif
  magick rose: -paint 10  rose_paint_10.gif
  magick rose: -blur 0x3 -paint 10  rose_blur_paint_10.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="../images/rose.gif"><img src="../images/rose.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="rose_paint_1.gif"><img src="rose_paint_1.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_paint_3.gif"><img src="rose_paint_3.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_paint_5.gif"><img src="rose_paint_5.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_paint_10.gif"><img src="rose_paint_10.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="rose_blur_paint_10.gif"><img src="rose_blur_paint_10.gif" align="middle" vspace="05" hspace="5" border="1" alt="[IM Output]"></a>
          </div>Notice that at a high radius for the paint blobs, the blobs start to get a squarish look to them. This effect can be smoothed somewhat by blurring the image slightly before hand, as shown in the last image above. It is an interesting effect and could be used to make some weird and wonderful background images. For example see its use in <a href="../backgrounds/#paint_raw10">Background Examples</a>. On final warning. While "<code><a href="https://imagemagick.org/script/command-line-options.php?#paint">-paint</a></code>" is supposed to produce areas of a single solid color, at large radius values, it has a tendency to produce a vertical gradient in some areas. This is most annoying, and may be a bug. Does anyone know? There are alternative to using "<code><a href="https://imagemagick.org/script/command-line-options.php?#paint">-paint</a></code>". One is to use "<code>-statistic Mode</code>" instead, which assigns each pixel with the 'predominate color' within the given rectangular neighbourhood, and can produce a nicer result.
          <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -statistic Mode 10 rose_paint_mode.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_paint_mode.gif"><img src="rose_paint_mode.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Another is to use some of the <a href="../morphology/">Morphology Methods</a>, and more specifically the <a href="../morphology/#intensity">Intensity Variant for Color Images</a>. Here for example is an 'OpenIntensity' Morphology on the rose.
          <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -morphology OpenI Disk rose_paint_open.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_paint_open.gif"><img src="rose_paint_open.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>And here I use 'CloseIntensity' with a slightly smaller 'Disk'.
          <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -morphology CloseI Disk:2.5 rose_paint_close.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_paint_close.gif"><img src="rose_paint_close.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>You don't have to use 'disks', but can design your own 'brush' shaped kernel for the blobs that it creates. For example what about using a diagonal line brush. <a name="charcoal" id="charcoal"></a>
          <h3>Charcoal, artists sketch of a scene</h3>The charcoal effect is meant to simulate artist's charcoal sketch of the given image. The "<code><a href="https://imagemagick.org/script/command-line-options.php?#charcoal">-charcoal</a></code>" operator is in some respects similar to edge detection transforms used by <a href="#vision">Computer Vision</a>. Basically it tries to magick the major borders and edges of object in the image into pencil and charcoal shades. The one argument is supposed to represent the thickness of the edge lines.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -charcoal 1   rose_charcoal_1.gif
  magick rose: -charcoal 3   rose_charcoal_3.gif
  magick rose: -charcoal 5   rose_charcoal_5.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="../images/rose.gif"><img src="../images/rose.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="rose_charcoal_1.gif"><img src="rose_charcoal_1.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_charcoal_3.gif"><img src="rose_charcoal_3.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_charcoal_5.gif"><img src="rose_charcoal_5.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
          </div>For a better example of using a charcoal transformation on a real image see <a href="../photos/#charcoal">Charcoal Sketch of a Photo</a>.
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/expert.gif" width="23" height="26"><img src="../img_www/space.gif" width="17" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>Technically the "<code><a href="https://imagemagick.org/script/command-line-options.php?#charcoal">-charcoal</a></code>" operator is a "<code><a href="https://imagemagick.org/script/command-line-options.php?#edge">-edge</a></code>" operator with some thresholding applied to a grey-scale conversion of the original image.</i></font></td>
            </tr>
          </table><a name="sketch" id="sketch"></a>
          <h3>Pencil Sketch Transform</h3>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#sketch">-sketch</a></code>" operator basically applies a pattern of line strokes to an image to generate what looks like an artistic pencil sketch. Arguments control the length and angle of the strokes. However it is best applied to a larger image with distinct and shadings. See <a href="../photos/#pencil">Pencil Sketch</a> for a full example of this operator and how it works internally. <a name="emboss" id="emboss"></a>
          <h3>Emboss, creating a metallic impression</h3>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#emboss">-emboss</a></code>" operator tries to generate the effect of an acid impression of a grey-scale image on a sheet of metal. It is in many respects very similar to the "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" operator we will look at <a href="#shade">below</a>, but without the 3D looking edges. Its argument is a radius/sigma, with only the sigma being important. I not found the argument very useful, and may in fact be buggy. The argument has also changed in a recent version of IM. I just don't know what is going on. Help me understand if you can.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -emboss 0x.5  rose_emboss_0x05.gif
  magick rose: -emboss 0x.9  rose_emboss_0x09.gif
  magick rose: -emboss 0x1   rose_emboss_0x10.gif
  magick rose: -emboss 0x1.1 rose_emboss_0x11.gif
  magick rose: -emboss 0x1.2 rose_emboss_0x12.gif
  magick rose: -emboss 0x2   rose_emboss_0x20.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="../images/rose.gif"><img src="../images/rose.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="rose_emboss_0x05.gif"><img src="rose_emboss_0x05.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_emboss_0x09.gif"><img src="rose_emboss_0x09.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_emboss_0x10.gif"><img src="rose_emboss_0x10.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_emboss_0x11.gif"><img src="rose_emboss_0x11.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_emboss_0x12.gif"><img src="rose_emboss_0x12.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_emboss_0x20.gif"><img src="rose_emboss_0x20.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
          </div>The operator is a grey-scale operator, meaning it will be applied to the three color channels, separately. As such should only be applied to grey-scale images. As you saw above, color images can produce some weird effects.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -colorspace Gray  -emboss 0x.5  rose_g_emboss_0x05.gif
  magick rose: -colorspace Gray  -emboss 0x.9  rose_g_emboss_0x09.gif
  magick rose: -colorspace Gray  -emboss 0x1   rose_g_emboss_0x10.gif
  magick rose: -colorspace Gray  -emboss 0x1.1 rose_g_emboss_0x11.gif
  magick rose: -colorspace Gray  -emboss 0x1.2 rose_g_emboss_0x12.gif
  magick rose: -colorspace Gray  -emboss 0x2   rose_g_emboss_0x20.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="../images/rose_grey.gif"><img src="../images/rose_grey.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="rose_g_emboss_0x05.gif"><img src="rose_g_emboss_0x05.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_g_emboss_0x09.gif"><img src="rose_g_emboss_0x09.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_g_emboss_0x10.gif"><img src="rose_g_emboss_0x10.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_g_emboss_0x11.gif"><img src="rose_g_emboss_0x11.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_g_emboss_0x12.gif"><img src="rose_g_emboss_0x12.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_g_emboss_0x20.gif"><img src="rose_g_emboss_0x20.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
          </div>
          <pre> If anyone knows exactly what the emboss algorithm is supposed to do,
please let me know.

</pre><a name="stegano" id="stegano"></a>
          <h3>Stegano, hiding a secret image within an image</h3>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#stegano">-stegano</a></code>" operator is really more of a 'fun' operator. For example it could be use by a spy to hide info in the 'chaos' of a random image. First a warning...
          <div align="center">
            <b>Do not use JPEG, GIF, or any other 'lossy' image encoding with Stegano</b>
          </div>For example, lets generate a cryptic message (image) that you want to send to your fellow spy...
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="top">
              <td width="10%" align="justify" rowspan="2"></td>
              <td width="90%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -gravity center -size 50x40 label:"Watch\nthe\nPidgeon" message.gif
</samp><code execute="" nowarn="" out="message_size.txt">  magick identify message.gif
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="center" rowspan="2">
                <a href="message.gif"><img src="message.gif" width="50" height="40" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
            <tr>
              <td>
                <table border="0" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <a href="message_size.txt"><img src="message_size.txt.gif" align="middle" vspace="0" hspace="0" border="0" alt="[IM Text]"></a>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>Note that we will also need the size of the message image (36x43 pixels), thus the identify in the above. Next the put it into some image with some offset. The offset (and message size) used is the cryptographic 'key' for the hidden message.
          <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick composite message.gif rose: -stegano +15+2  rose_message.png
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rose_message.png"><img src="rose_message.png" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Now you can send that image to your compatriot, who presumably already knows the messages size and offset. We can the recover the message hidden in the image...
          <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -size 50x40+15+2 stegano:rose_message.png message_recovered.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="message_recovered.gif"><img src="message_recovered.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>The larger the containing image the better the recovered image will be, so hiding small images in larger ones is better than the example shown above.Just to show you how the hidden message was distributed throughout the container image, lets do a comparison of the combined image against the original.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="top">
              <td width="10%" align="justify" rowspan="2"></td>
              <td width="90%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" err="rose_diff_pae.txt">
  magick compare -metric PAE rose: rose_message.png   rose_difference.png
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="center" rowspan="2">
                <a href="rose_difference.png"><img src="rose_difference.png" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
            <tr>
              <td>
                <table border="0" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <a href="rose_diff_pae.txt"><img src="rose_diff_pae.txt.gif" align="middle" vspace="0" hspace="0" border="0" alt="[IM Text]"></a>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>Which shows how the message image was encrypted and distributed all over the container image to hide it. Also the '<code>PAE</code>' metric returned by the above shows that the largest difference was only a single color value out of the 8 bit color values used for this image. That is, tiny. So tiny that a small change or modification to the image will destroy the message hidden within. It is such a small difference, you can't even use JPEG with its lossy compression as the image format, or any other lossy image format (including GIF) for the container image. Also if you had the wrong 'offset key' you will not get the message...
          <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -size 50x40+14+2 stegano:rose_message.png message_bad.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="message_bad.gif"><img src="message_bad.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>You can also limit what area of the image the message is to be hidden by using a <a href="../masking/#region">Region</a> setting. The same setting will also be needed when attempting to recover the message. This would probably make finding and decoding the hidden message in a large image, especially if restricted to a 'busy' area, an order of magnatitude harder to determine. However be warned that this is not a very cryptographically secure technique. Especially if the original source image is also available. Frequency analysis of the image will generally let an attacker know there is a hidden message. As a method of image copyright protection, the <a href="#stegano">Stegano Operator</a> is also useless, as the smallest change to the image will destroy the message, and thus its effectiveness. As a spy tool it is also not very good, with such a small number of 'combinations' for a reasonable sized image. Anyone who knows roughly what you are doing could probably crack it quickly. Better to stick to well known and time tested cryptographic methods. It's only real practical use is as a fun tool, or as a way to add very small amounts of noise to an existing image. <a name="encipher" id="encipher"></a>
          <h3>Encrypting Image Data</h3>The operators "<code><a href="https://imagemagick.org/script/command-line-options.php?#encipher">-encipher</a></code>" and "<code><a href="https://imagemagick.org/script/command-line-options.php?#decipher">-decipher</a></code>" will basically encrypt image data into a garbled mess. That is, the image content itself is no longer recognisable at all until the image is later decrypted. This can be used for example to protect sensitive images on public services, so that only others with the secret pass-phrase can later view it. But first a warning...
          <div align="center">
            <b>Do not use JPEG, GIF, or any other 'lossy' image encoding with Encryption</b>
          </div>For example lets encrypt that secret message image we created above, using a pass-phrase I have saved in a, not quite so 'secret', file "<a href="pass_phrase.txt">pass_phrase.txt</a>". <!-- <CODE EXECUTE NO_TXT2GIF>
  echo "This is a secret pass-phrase, for image encryption" > pass_phrase.txt
</CODE> -->
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick message.gif    -encipher pass_phrase.txt  \
          -depth 8 png24:message_hidden.png
</samp></pre>
                </td>
              </tr>
            </table><a href="message.gif"><img src="message.gif" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="message_hidden.png"><img src="message_hidden.png" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a>
          </div>
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>The encrypted image assumes it is saved using a 8 bit image file format. As such it is recommended to enforce that limitation by setting "<code><a href="https://imagemagick.org/script/command-line-options.php?#depth">-depth</a> 8</code>" before the final save to the output file.<br>
              <br>
              The "<code>png24</code>" was also needed in the above to ensure that the output is not a palette or colormapped "png8:" image, which also does not work properly.</i></font></td>
            </tr>
          </table>As you can see the resulting image looks like complete garbage, with no indication of the images real content. Now you can publish that image on the web, and only someone who knows the exact original pass-phrase can restore the image data...
          <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick message_hidden.png -decipher pass_phrase.txt message_restored.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="message_restored.gif"><img src="message_restored.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>However be warned that if the image data is corrupted in some way, you will not be able to restore it. That includes if the PNG saved using a gray-scale image format type. As such, only a non-lossy image format can be used, such as PNG, MIFF, TIFF, or even <a href="../files/#txt">Pixel Enumeration Text</a>. However using a lossy image format, such as JPEG, PNG8, and GIF, will corrupt the image data, thus destroy the resulting encryption. Note that any meta-data that may be describing the image, will still be in the clear. That means, you could encrypt images using the images own 'comment' string as the pass-phrase or use that comment encrypted using some smaller password. Its a simple idea that could make the pass-phrase more variable. Encrypting an image can be just one step. Taking the result just that little further can produce an image that will not simply decrypt, without some extra processing. For example, here I use some <a href="../warping/#simple">Simple Non-Destructive Distorts</a> to confuse anyone trying to decrypt the image in the normal way.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  echo "password" | magick message.gif -encipher - \
                      -transpose  -depth 8   png24:message_obfuscate.png
  echo "password" | magick message_obfuscate.png -transpose \
                      -decipher -  message_restored_2.png
</samp></pre>
                </td>
              </tr>
            </table><a href="message.gif"><img src="message.gif" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="message_obfuscate.png"><img src="message_obfuscate.png" width="40" height="50" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="message_restored_2.png"><img src="message_restored_2.png" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a>
          </div>If you did not include the "<code><a href="https://imagemagick.org/script/command-line-options.php?#transpose">-transpose</a></code>" in the decryption command above, the image will not have deciphered correctly. Also note that due to the streaming cipher used (see the expert note below) using just a "<code><a href="https://imagemagick.org/script/command-line-options.php?#roll">-roll</a></code>" of some sort will not prevent the image from being decrypting, at least partially. Note that in the above I did not use a file to hold the 'pass-phrase' but fed the phrase into the "<code>magick</code>" command using standard input, which allows you use some other program or command to get the phrase from the user, generate it, or some other method, instead of using text file with the pass-phrase in the clear. The pass-phrase could also be generated from other freely downloadable files and images. For example you could decrypt your image using the signature, or comment string of a well known, freely downloadable reference image. For instance here I use the signature of the "<code>rose.gif</code>" image to encrypt and later decrypt the "<code>message.gif</code>" image.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick identify -format %# rose.gif |\
    magick message.gif  -encipher - -depth 8    png24:message_signed.png
  magick identify -format %# rose.gif |\
    magick message_signed.png   -decipher -   message_restored_3.png
</samp></pre>
                </td>
              </tr>
            </table><a href="message.gif"><img src="message.gif" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" align="middle" width="20" height="20" alt=" + "> <a href="../images/rose.gif"><img src="../images/rose.gif" width="70" height="46" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="message_signed.png"><img src="message_signed.png" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" align="middle" width="20" height="20" alt=" + "> <a href="../images/rose.gif"><img src="../images/rose.gif" width="70" height="46" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="message_restored_3.png"><img src="message_restored_3.png" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a>
          </div>As of IM v6.4.8-0 the file used by "<code><a href="https://imagemagick.org/script/command-line-options.php?#encipher">-encipher</a></code>" and "<code><a href="https://imagemagick.org/script/command-line-options.php?#decipher">-decipher</a></code>" can be a binary file. As such you could even directly use an image itself as the the passphrase.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick message.gif   -encipher rose.gif  -depth 8  png24:message_binary.png
  magick message_binary.png   -decipher rose.gif   message_restored_4.png
</samp></pre>
                </td>
              </tr>
            </table><a href="message.gif"><img src="message.gif" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" align="middle" width="20" height="20" alt=" + "> <a href="../images/rose.gif"><img src="../images/rose.gif" width="70" height="46" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="message_binary.png"><img src="message_binary.png" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" align="middle" width="20" height="20" alt=" + "> <a href="../images/rose.gif"><img src="../images/rose.gif" width="70" height="46" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="message_restored_4.png"><img src="message_restored_4.png" width="50" height="40" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a>
          </div>
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/expert.gif" width="23" height="26"><img src="../img_www/space.gif" width="20" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>Before IM v6.4.8-0 a binary file would stop at the first 'NULL' character it finds. Something that would happen rather early if a PNG image was used.</i></font></td>
            </tr>
          </table>This technique is exact (unless some of the data was destroyed in transmission). And as such you can use it to encrypt an image containing other hidden information such as a <a href="#stegano">Stegano Image</a>. This means even if authorities do decrypt the image, or force you to reveal the password, they will see actual image, but that image may not be the final hidden one.
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/warning.gif" width="28" height="28"><img src="../img_www/space.gif" width="12" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#encipher">-encipher</a></code>" and "<code><a href="https://imagemagick.org/script/command-line-options.php?#decipher">-decipher</a></code>" operators was added to IM v6.3.8-6, but required you to include a "<code>--enable-cipher</code>" option in the build configuration. However by IM v6.4.6 (when did it change?) this configuration item was no longer needed and it became a standard configuration setting. As such you can probably use it immedaitally.</i></font></td>
            </tr>
          </table>
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/expert.gif" width="23" height="26"><img src="../img_www/space.gif" width="17" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>The cipher was implemented using a self-synchronizing stream cipher implemented from a block cipher.<br>
              <br>
              This means that you can still decipher even a partial download of the image, which was destroyed by transmission error, even though some part of the image may have been destroyed. You also do not need to downloaded the whole image to decrypt and examine the parts that was successfully downloaded.<br>
              <br>
              But you do need the pass-phase to have any chance at all of successfully decrypting the image, as it is a very very strong encryption.<br>
              <br></i></font></td>
            </tr>
          </table><a name="pixelate" id="pixelate"></a>
          <h3>Pixelate an Image</h3>Pixelating an image is basicaly used to magick an image into a set of large colored 'pixels' that only shows a vague outline of the original image. Both techniques involve shrinking the image (to generate fewer pixels), then enlarging them in such a way so as to create 'pixel block' using either a <a href="../resize/#scale">Scaling Operator</a> or <a href="../resize/#sample">Sampling Operator</a> to generate the block of color. It is just how the image is reduced that determines exactly what color wil be used. A single pixel sample, or a merged average color.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -sample 25%  -scale 70x46\!  rose_pixelate_sampled.gif
  magick rose: -scale  25%  -scale 70x46\!  rose_pixelate_scaled.gif
  magick rose: -resize 25%  -scale 70x46\!  rose_pixelate_resized.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="../images/rose.gif"><img src="../images/rose.gif" width="76" height="46" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="rose_pixelate_sampled.gif"><img src="rose_pixelate_sampled.gif" width="70" height="46" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_pixelate_scaled.gif"><img src="rose_pixelate_scaled.gif" width="76" height="46" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_pixelate_resized.gif"><img src="rose_pixelate_resized.gif" width="70" height="46" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a>
          </div>As you can see, the 'sampled' areas will have much more distinct (aliased) 'pixels', while the other two uses a merged or averaged color, which tends to produce more muted, but more accurite color representation for each 'pixel'. See also <a href="../photos/#anonymity">Protect Someones Anonymity</a> for an example of using this on just a smaller masked area of the image, such as a persons face. <a name="gridding" id="gridding"></a>
          <h3>Grids of Pixels</h3>Gridding an image is very similar to pixelating an image. In this case we want only want to enlarge the image, to generate distinct pixel-level view of an image's details. Typically a very small image. The simplest way is like the previous example, simply <a href="../resize/#scale">Scale</a> a small image, to enlarge the pixels.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -crop 10x10+12+20 +resize  grid_input.png
  magick grid_input.png  -scale  1000%  grid_scale.png
</samp></pre>
                </td>
              </tr>
            </table><a href="grid_input.png"><img src="grid_input.png" width="10" height="10" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="grid_scale.png"><img src="grid_scale.png" width="100" height="100" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a>
          </div>The problem with a simple scaling, is that in areas where pixels are similar in color, you can have trouble seeing the individual 'pixel blocks'. What we need to add a border around the pixels, to separate them. For this we need to overlay a generated tile mask. See <a href="../canvas/#tile_memory">Tiling with an Image already In Memory</a> for various methods of using a generated tiling image, in a single command.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                Here we generate a white on black 'grid' which is overlayed using <a href="../compose/#screen">Screen Composition</a> (overlay white, while leaving black areas as-is).
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -size 10x10 xc: -draw 'rectangle 1,1 9,9' -write mpr:block +delete \
          grid_input.png -scale 1000% -size 101x101 tile:mpr:block \
          +swap -compose screen -composite grid_blocks.png
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="grid_blocks.png"><img src="grid_blocks.png" width="101" height="101" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Note that the size used to generate the tile is <code><i>scale</i>*<i>image_size</i>+<i>gap_size</i></code> (in this case 10*10+1 =&gt; 101). I also <a href="../basics/#swap">Swapped</a> the two images so that the final image size comes from the tile image, rather than from the scaled image which is one pixel smaller in size. However this may lose any image meta-data that was in the original image as I used the tiled image for the destination.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                Here I generate circular 'spots' of color, but this time used a <a href="../compose/#multiply">Multiply Composition</a> (overlay black, while leaving white areas as-is).
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -size 10x10 xc: -draw 'circle 5,5 1,3' -negate \
               -write mpr:spot +delete \
          grid_input.png -scale 1000% -size 101x101 tile:mpr:spot \
          +swap -compose multiply -composite grid_spots.png
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="grid_spots.png"><img src="grid_spots.png" width="101" height="101" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>You can make the grid border transparent by also negating the tiled overlay (black areas become transparent) and use a <a href="../compose/#copyopacity">CopyOpacity Composition</a> instead of <a href="../compose/#multiply">Multiply</a>. Other colors can also be added, but for this to work you have to use a tile image that actually contains real transparency. For this you need to convert the black and white tile image into a <a href="../masking/#shapes">Shaped Mask</a>.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                For example, here I use <a href="../morphology/#basic">Basic Morphology Operator</a> to generate a diamond shaped 'holes' in a colored overlay. For this a single 'seed' pixel is drawn and expanded using a <a href="../morphology/#diamond">Diamond Morphology Kernel</a>.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -size 10x10 xc: -draw 'point 5,5' -morphology Erode:4 Diamond \
          -background Navy -alpha shape -write mpr:diamond +delete \
          grid_input.png -scale 1000% -splice 1x1+0+0 \
          -size 101x101 -background none tile:mpr:diamond \
          -alpha set -compose Over -composite grid_diamonds.png
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="grid_diamonds.png"><img src="grid_diamonds.png" width="101" height="101" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>Note that the "<code>tile:</code>" coder will replace any transparency in the image with the current background color. If you want to preserve the transparency of the tiling image, either set "<code>-background none</code>" or "<code>-compose Src</code>". The former is easier.</i></font></td>
            </tr>
          </table>Note techniqually, the alpha shaping can be done either before saving the tile image, or after tiling the tile image, before overlaying it. The choice is yours. One final technique is to use a bad resampling filter to produce a <a href="../distorts/#distort_failure">Resampling Failure</a> to generate aliased circles of each pixel. This is not great technique (mis-using image processing failure), but it does form a Grid of Pixels. <a name="spacing_tiles" id="spacing_tiles"></a>
          <h3>Spacing Out Tiles</h3>A similar problem is spacing out a grid of tiles in an image. this is not simply scaling up individual pixels into 'pixel blocks' but inserting space between rectangluar areas of an image. That is, <a href="../crop/#splice">Splicing</a> extra pixels into an image at regular intervals. Currently the best solution is to break up the image into <a href="../crop/#crop_strip">Rows and Columns</a> and <a href="../crop/#splice">Splicing</a> in the extra spacing onto each tile before <a href="../layers/#append">Appending</a> the tiles back together. For example...
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -background SkyBlue \
          -crop 10x0 +repage -splice 3x0 +append \
          -crop 0x10 +repage -splice 0x3 -append \
          grid_tile.png
</samp></pre>
                </td>
              </tr>
            </table><a href="../images/rose.gif"><img src="../images/rose.gif" width="76" height="46" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="grid_tile.png"><img src="grid_tile.png" width="91" height="61" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a>
          </div>Here is another method which also separates the original image into tiles, but then uses some <a href="#fx_escapes">DIY FX Expressions</a> to calculate the new postion of a tile, from its old position.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="middle">
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -crop 10x10 \
          -set page '+%[fx:page.x+3*page.x/10]+%[fx:page.y+3*page.y/10]' \
          -background skyblue -layers merge +repage  grid_tile_fx.png
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="grid_tile_fx.png"><img src="grid_tile_fx.png" width="88" height="58" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>The number '<code>3</code>' in the above is the gap width to add, and '<code>10</code>' is the tile size. All that you need is to add a border or other edge to the result. With a little more work you can even add some random 'jitter' to the placement of each tile in the above grid, for a less regular effect. The problem with both these methods is that generating lots of small images, only to join them back together does generate a lot of work. Especially for very small tiles sizes. A better method that has been proposed is a special extension to the <a href="../crop/#splice">Splice Operator</a>, in the IM Forum Discussion <a href="https://magick.imagemagick.org/viewtopic.php?f=2&amp;t=21060&amp;p=85371">Splice (adding tile gridding gaps)</a>.
          <hr>
          <!-- ---------------------------------------------------------------- -->
          <a name="vision" id="vision"></a>
          <h2>Computer Vision Transformations</h2><a name="edge" id="edge"></a>
          <h3>Edge Detection</h3>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#edge">-edge</a></code>" operator highlights areas of color gradients within an image. It is a grey-scale operator, so is applied to each of the three color channels separately.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick mask.gif -edge 1   mask_edge_1.gif
  magick mask.gif -edge 2   mask_edge_2.gif
  magick mask.gif -edge 3   mask_edge_3.gif
  magick mask.gif -edge 10  mask_edge_10.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="mask.gif"><img src="mask.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="mask_edge_1.gif"><img src="mask_edge_1.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="mask_edge_2.gif"><img src="mask_edge_2.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="mask_edge_3.gif"><img src="mask_edge_3.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="mask_edge_10.gif"><img src="mask_edge_10.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
          </div>As you can see, the edge is added only to areas with a color gradient that is more than 50% white! I don't know if this is a bug or intentional, but it means that the edge in the above is located almost completely in the white parts of the original mask image. This fact can be extremely important when making use of the results of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#edge">-edge</a></code>" operator. For example, if you're performing edge detection on an image that contains a black outline, the "<code><a href="https://imagemagick.org/script/command-line-options.php?#edge">-edge</a></code>" operator will 'twin' the black lines, producing a weird result.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick piglet.gif  -colorspace Gray  -edge 1 -negate  piglet_edge.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="../images/piglet.gif"><img src="../images/piglet.gif" width="100" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="piglet_edge.gif"><img src="piglet_edge.gif" width="100" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
          </div>
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                However by negating the image before doing the edge detecting, the twined lines go inward and join together, removing the 'twin line' effect.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick piglet.gif -colorspace Gray \
                 -negate -edge 1 -negate    piglet_edge_neg.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="piglet_edge_neg.gif"><img src="piglet_edge_neg.gif" width="100" height="100" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                I have found that the edges tend to be too sharp, generating a non-smooth edge to the resulting images. As such I find a very very slight blur to the result improves the look quite a bit.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick piglet_edge_neg.gif  -blur 0x.5  piglet_edge_blur.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="piglet_edge_blur.gif"><img src="piglet_edge_blur.gif" width="100" height="100" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Here I have applied edge detection to a color image, and a grey-scale version to show you its effects on photo-like images.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick rose:                  -edge 1  rose_edge.gif
  magick rose: -colorspace Gray  -edge 1  rose_edge_grey.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="rose_edge.gif"><img src="rose_edge.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="rose_edge_grey.gif"><img src="rose_edge_grey.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
          </div>As you can see without converting the image to grey-scale the edges for the different color channels are generated completely independent of each other. <a name="canny" id="canny"></a>
          <h3>Canny Edge Detector</h3>As on IM v6.8.9-0, IM now supports the canny edge detector. (See <a href="https://magick.imagemagick.org/viewtopic.php?f=4&amp;t=25405">Announcment Examples</a> on the IM Forum). This is a very advanced edge detection algorithm, that produces a very strong (binary) single pixel wide lines at all sharp edges, with very little noise interferance. For example, here we apply it to the test images we used above..
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick mask.gif           -canny 0x1+10%+30%  mask_canny.gif
  magick piglet.gif         -canny 0x1+10%+30%  piglet_canny.gif
  magick piglet.gif -negate -canny 0x1+10%+30%  piglet_canny_neg.gif
  magick rose:             -canny 0x1+10%+30%  rose_canny.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="mask.gif"><img src="mask.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="mask_canny.gif"><img src="mask_canny.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a><br>
            <a href="piglet_canny.gif"><img src="piglet_canny.gif" align="middle" vspace="5" hspace="25" border="1" alt="[IM Output]"></a> <a href="piglet_canny_neg.gif"><img src="piglet_canny_neg.gif" align="middle" vspace="5" hspace="25" border="1" alt="[IM Output]"></a> <a href="rose_canny.gif"><img src="rose_canny.gif" align="middle" vspace="5" hspace="25" border="1" alt="[IM Output]"></a>
          </div>As you can see it produces a much sharper result than the <a href="#edge">Edge Operator</a> above. The fuzzy anti-aliased edge has little to no effect, on the result producing thin bitmap lines. Also as the piglet image shows it is not placed on one specific side as the previous edge operator did. As a result, negating the input image has no effect. But like all edge detectors it can have problems with real world images with 'busy' backgrounds, such as the built-in rose image. This clean result is very important later in <a href="#hough">Hough Line Detection</a>. <a name="edge_jitter" id="edge_jitter"></a>
          <h3>Edge Outlines from Anti-Aliased Shapes</h3>The biggest problem with normal edge detection methods is that the result is highly aliased. That is, it generates a very staircase like pixel effects, regardless of if the shape is smooth (anti-aliased) or aliased. For example, here is a smooth anti-aliased voice balloon ("WebDings" font character '<code>(</code>' ).
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -size 80x80 -gravity center -font WebDings label:')' voice.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="voice.gif"><img src="voice.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>And here is its edge detected image...
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick voice.gif -edge 1 -negate   voice_edge.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="voice_edge.gif"><img src="voice_edge.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>As you can see it looks horrible, with some minor anti-aliasing on the outside of the edge, and a total aliased (staircase) look on the inside of the line. The negating the image generated a similar outline around the outside of the image, but also has strong aliasing outside of the line.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick voice.gif -negate -edge 1 -negate   voice_edge_negate.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="voice_edge_negate.gif"><img src="voice_edge_negate.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>An alternative when you already have an image with an anti-aliased edge, is to generate the difference image of a 'jittered' clone of the original shape. For example, here we find the difference image between the original, image and one that has been offset (or jittered) to the right by 1 pixel.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick voice.gif \( +clone -roll +1+0 \) -compose difference -composite \
          -negate   voice_jitter_horiz.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="voice_jitter_horiz.gif"><img src="voice_jitter_horiz.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Note that the this does not produce a good edge for horizontal sloped edges. However by combining both a horizontal and a vertical jittered difference image, we can get a very good anti-aliased outline of the shape.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick voice.gif \
          \( -clone 0 -roll +1+0 -clone 0 -compose difference -composite \) \
          \( -clone 0 -roll +0+1 -clone 0 -compose difference -composite \) \
          -delete 0  -compose screen -composite -negate  voice_jitter_edge.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="voice_jitter_edge.gif"><img src="voice_jitter_edge.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>This technique also has the advantage of working regardless of if the mask is negated or not. Note however that the result has a 1/2 pixel offset relative to the original image, so it may require some further 'distortion' processing to re-align either the original shape, or the outline if the two needs to be combined to get the result you want. <a name="edge_bitmap" id="edge_bitmap"></a>
          <h3>Edge Outlines from Bitmap Shapes</h3>Bitmap images are much harder, as they don't have any anti-aliased pixels that can be used to produce a smooth outline. For example, here is a fancy 'Heart' shape that was extracted from the "WebDings" font (character '<code>Y</code>'). However I purposefully generated it as an aliased bitmap, to simulate a horrible bitmap image downloaded from the network. Such as the outline of a GIF image containing transparency.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick +antialias -size 80x80 -gravity center \
          -font WebDings label:Y   heart.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart.gif"><img src="heart.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>So we have this horrible image, but we want to find the images outline rather than its shape. Direct use of edge detection will only generate a pure bitmap edge around the outside of the bitmap shape.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick heart.gif -edge 1 -negate   heart_edge.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart_edge.gif"><img src="heart_edge.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr valign="bottom">
              <td width="100%" align="justify">
                A negated edge generates an edge image but for the inside of the black area.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick heart.gif -negate -edge 1 -negate   heart_edge_negate.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart_edge_negate.gif"><img src="heart_edge_negate.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>By adding both of the above you get a 2 pixel edge centered on the bitmap shapes edge.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick heart.gif \( +clone -negate \) -edge 1 \
          -compose add -composite  -negate  heart_edge_double.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart_edge_double.gif"><img src="heart_edge_double.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>As you can see the resulting image is highly aliased with 'staircase' like effects in the outline, even though the original image is itself not too bad in this regard. This is not a good solution. A slightly better edge can be created by using an '<code><a href="../morphology/#edge-in">EdgeIn</a></code>' morphology method, or others like it.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick heart.gif  -negate -morphology EdgeIn Diamond -negate heart_edgein.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart_edgein.gif"><img src="heart_edgein.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>And a similar effect can be achieved by just using resizes to blur the edge in the right way, before using a <a href="../color_mods/#solarize">Solarize</a> to extract the mid-gray pixels that form the edge. A thicker edge can be generated by adding a "<code>-filter Cubic</code>" setting, or some other <a href="../filter/#filter">Resampling Filters</a>.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick heart.gif -resize 400% -resize 25% \
          -solarize 50% -evaluate multiply 2 -negate heart_resize.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart_resize.gif"><img src="heart_resize.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Or for more controlled fuzzier effect you can just blur the shape and extract the edge in a similar way. I find a blur of '<code>0.7</code>' about the best, with a 3 pixel limit to speed things up.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick heart.gif -blur 3x.7 -solarize 50% -level 50%,0 heart_blur.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart_blur.gif"><img src="heart_blur.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Note the use of <a href="../color_mods/#level">Level Operator</a>, which is the equivalent of the "<code>-evaluate multiply 2 -negate</code>" used in the previous example. With an anti-aliased border you can now re-add the original shape if you just want to smooth the original shape rather than get its outline. Just remember that the outline is positioned exactly along the edge of the original image, so will be half a pixel larger in size that the previous examples. <i>Do you know of any other ways of generating an anti-aliased outline from a shape (anti-aliased, or bitmap). If so please mail it to me, or the IM forum. You will be credited.</i> <a name="edge_vector" id="edge_vector"></a>
          <h3>Edging using a Raster to Vector Converter</h3>One of the most ideal solutions is to use a non-IM '<i>raster to vector</i>' conversion program to magick this bitmap shape into a vector outline. Programs that can do this include: "<code>ScanFont</code>", "<code>CorelTrace</code>", "<code>Streamline</code>" by Abobe, and "<code><a href="http://vectormagic.com/home">Vector Magic</a></code>". Most of these however cost you at least some money. "VectorMagick" and another tracing program "<a href="http://www.autotracer.org/">AutoTracer</a>" have free to use online image converters available. Other free solutions are "<code><a href="http://autotrace.sourceforge.net/">AutoTrace</a></code>", or "<code><a href="http://potrace.sourceforge.net/">PoTrace</a></code>". More suggestions are welcome. These trace programs are simple to use, but typically requires some form of pre and post image setup. They have a limited number of input formats, and outputs a vector image which will create a 'smoothed' form of the input image. I prefer the "<code>AutoTrace</code>" as it does not scale the resulting SVG data, and thus producing a standard line thickness, however you can not use it in a 'pipeline'. For best results it is a good idea to ensure we only feed it a basic bitmap image, which we can ensure by thresholding the input image, while we convert it to an image format autotrace understands. I can then magick that image into a SVG vector image.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre><code execute="" script="" image="heart_svg.gif" err="/dev/null">
  magick heart.gif -colorspace gray -threshold 50% heart_tmp.pbm
  autotrace -output-format svg -output-file heart.svg heart_tmp.pbm
  magick heart.svg heart_svg.gif
  rm -f heart_tmp.pbm
</code></pre>
                </td>
              </tr>
            </table>
            <table border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td>
                  <a href="heart.gif"><img src="heart.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                </td>
                <td><img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"></td>
                <td>
                  <table border="0" cellspacing="0" cellpadding="5" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <a href="heart.svg"><img src="heart.svg.gif" align="middle" vspace="0" hspace="0" border="0" alt="[IM Text]"></a>
                      </td>
                    </tr>
                  </table>
                </td>
                <td><img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"></td>
                <td>
                  <a href="heart_svg.gif"><img src="heart_svg.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                </td>
              </tr>
            </table>
          </div><!-- <CODE EXECUTE NOIMAGE>
  txt2gif -fmt heart.svg
</CODE> -->
          As of IM v6.4.2-6 you can do the above sequence directly using the "<code>autotrace:</code>" image input delegate. This only requires the "<code>autotrace</code>" command to be installed. For example
          <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick autotrace:heart.gif  heart_traced.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart_traced.gif"><img src="heart_traced.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>If your IM was built with the "<code><a href="http://autotrace.sourceforge.net/">AutoTrace</a></code>" delegate library, you can also have IM directly generate the SVG image from an image in memory. For details of this see <a href="../draw/#svg_output">SVG Output Handling</a>. For example....
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre><code execute="" err="/dev/null">
  magick heart.gif  heart_2.svg
</code></pre>
                </td>
              </tr>
            </table>
            <table border="0" cellspacing="0" cellpadding="5" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <a href="heart_2.svg"><img src="heart_2.svg.gif" align="middle" vspace="0" hspace="0" border="0" alt="[IM Text]"></a>
                </td>
              </tr>
            </table>
          </div><!-- <CODE EXECUTE NOIMAGE>
  txt2gif -fmt heart_2.svg
</CODE> -->
          Now the SVG output will of course represent a smoothed version of the original image, which is not what we actually want in this example. But as we now have the shape of the bitmap in <i>vector form</i>, we can simply adjust the SVG '<code>style</code>' attributes so as to '<code>stroke</code>' the outline, rather than '<code>fill</code>' the shape. The modified SVG can then be fed back into ImageMagick again to recreate the clean outline raster image. For example...
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" script="" err="/dev/null">
  cat heart.svg |
    sed 's/"fill:#000000[^"]*"/"fill:none; stroke:black;"/' |
      magick svg:- heart_outline.gif
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart_outline.gif"><img src="heart_outline.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Yes it is a little awkward, but the smooth anti-aliased result is well worth the effort. It would be nice if outline or some other modifications could be specified as options to the "<code>autotrace</code>" command itself, but that is currently not a feature. You can also further modify the SVG output to thickening the edge, or specify some other stroke or background color, change the fill color of the vector edge shape. For example, here we generate a thicker outline of the shape with a red fill, all nicly anti-aliased.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre><code execute="" script="" err="/dev/null">
  cat heart.svg |
    sed 's/"fill:#000000;[^"]*"/"fill:red; stroke:black; stroke-width:5;"/' |
        magick svg:- heart_outline_thick.gif
</code></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="heart_outline_thick.gif"><img src="heart_outline_thick.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>Such a perfect looking heart could not have been generated from a bitmap shape in any other way. We could also just extract the '<code>d="..."</code>' path element to use directly as a <a href="../draw/#paths">SVG Path String</a> in the <a href="../draw/#intro">Draw Command</a>. This would then allow you to use any of the other IM draw settings with that vector outline, giving you complete control of the final result. For another example of using the "<code><a href="http://autotrace.sourceforge.net/">AutoTrace</a></code>" program, see <a href="../morphology/#autotrace_skeleton">Skeleton using Autotrace</a>. <a name="hough" id="hough"></a>
          <h3>Hough Line Detector</h3>The Hough Line Detector ("<code><a href="https://imagemagick.org/script/command-line-options.php?#hough-lines">-hough-lines</a></code>" added IM v6.8.9-1), is a very complex transform with a lot of stages (for details see <a href="http://en.wikipedia.org/wiki/Hough_transform">Wikipedia, Hough Transform</a>). Basically it is designed to examine an image, looking for white lines on a black background, and try to return the exact location of any line segments (linear sequences pixels) present in the image. This can be very important for things like removing image rotations, or determining the perspective transformation in an image, so it can be repeated, or removed. Here is the full set of options to the operator
          <center>
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  -background {<i>background</i>} -stroke {<i>line_color</i>} <!--
-->-hough-lines {<i>W</i>}x{<i>H</i>}+{<i>threshold</i>}
</samp></pre>
                </td>
              </tr>
            </table>
          </center>The colors (<i>background</i> and <i>line_color</i>) is used to set the colors of lines in the resulting image (if you actually draw them). The argument to the Hough Operator (<i>W</i>}x{<i>H</i>}+{<i>threshold</i>) is used to define the size and treshold of the filter used to find 'peaks' in the intermedite 'search image'. that is is controls how well it actuall 'finds' the lines we are trying to detect (see below). You would adjust these help find the line detection. For example lets try to find the lines in a rectangular shaped image. First we need to reduce the image to lines, and for a clean result the <a href="#canny">Canny Edge Detector</a> is recommened.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick shape_rectangle.gif -canny 0x1+10%+30% rectangle.gif
</samp></pre>
                </td>
              </tr>
            </table><a href="../images/shape_rectangle.gif"><img src="../images/shape_rectangle.gif" width="100" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="rectangle.gif"><img src="rectangle.gif" width="100" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
          </div>
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                Now lets apply the Hough Line Detector to this image.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rectangle.gif -background black -stroke red \
          -hough-lines 5x5+20   rectangle_lines.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rectangle_lines.gif"><img src="rectangle_lines.gif" width="100" height="100" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>As you can see 5 lines were found, 2 of which are very close together. The reason for the extra line is that the rectangle in the image is not perfect. Now while I am displaying a raster (GIF) image result, the Hough Operator actually generates a vector image in <a href="../draw/#mvg">Magick Vector Graphics Format</a>. This means you can list the line information for further processing.
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre><code execute="" txt2gif="">
  magick rectangle.gif -background black -stroke red \
          -hough-lines 5x5+20   rectangle_lines.mvg
</code></pre>
                </td>
              </tr>
            </table>
            <table border="0" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <a href="rectangle_lines.mvg"><img src="rectangle_lines.mvg.gif" align="absmiddle" vspace="0" hspace="0" border="0" alt="[IM Text]"></a>
                </td>
              </tr>
            </table>
          </div>Note that the lines are drawn from one edge (with floating point values) to another edge of the image. And from this you can see that the second and third lines are the two that are close. The comment in the MVG output gives you the accumulated number of pixels that the line 'hits' in the image, and thus is a good indication of how strong the line is in the image. This value will always be larger than the treshold value you give to the "<code><a href="https://imagemagick.org/script/command-line-options.php?#hough-line">-hough-line</a></code>" operator. From this you can see the first and last lines (which are close matches) are both roughly equal in strength, so it would be hard to pick one of them over another. If this happens to you, I suggest you try to improve your edge detection step. Note that MVG image does not have any colors defined. The color settings in this example were not actually used. The colors are only used if you actually 'draw' the vectors when converting the above result into a 'raster' image, as we did before.
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
              <td width="100%" align="justify">
                You can also see the intermedate 'search image', or 'accumulator' that is looking for white pixels in every orientation, by using a special <a href="../basics/#define">define</a>.
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick rectangle.gif \
          -define hough-lines:accumulator=true -hough-lines 5x5+20 \
          -delete 0 -contrast-stretch 0.1% rectangle_accumulator.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="rectangle_accumulator.gif"><img src="rectangle_accumulator.gif" width="180" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>The define will just append the 'search image' to the image result, which in this case we delete. We also applied some contast to the 'accumulated values' to make them more visible. This is the image that the arguments to the Hough Detector is searching. The image is always 180 pixels wide (1 pixel per degree of line angle), while the height is twice the diagonal length of the image. As such the location of the peak will directly define the angle of the line, and the perpendicular distance of the line relative to the center point of the input image. That is the X coordinate is the angle in degrees, and the Y coordinate the distance from center from -diagonal distance, to +diagonal distance. If you look closely at the lower-right peak you can see why we ended up with two lines instead of one. The peak here is 'twined' with a slight gap between them. The algorithm is based on the script "<code><a href="http://www.fmwconcepts.com/imagemagick/houghlines/">houghlines</a></code>" by Fred Wienhaus, though with a different 'perpendicular distance' accumulation handling.
          <hr width="30%">
          <!-- ------------ -->
          <a name="lat" id="lat"></a>
          <h3>Local Adaptive Thresholding</h3>
          <div align="center">
            <font size="+2"><b><img src="../img_www/const_barrier.gif" width="39" height="35" align="top"> Under Construction <img src="../img_www/const_hole.gif" width="144" height="50" align="middle"></b></font>
          </div>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#lat">-lat</a></code>" operator, tries to adaptively threshold each pixel based on the value of pixels in a surrounding window. This is commonly used to threshold images with an uneven background (i.e., uneven illumination). It is based on the assumption that pixels in a small window will have roughly the same background color and roughly the same foreground color.
          <pre>For example.
   magick input.png -lat 17 output.png
</pre>In the above a 17 pixel square 'window' is used to determine the average color of the image at each point, if the pixel is darker than this average it is made black, if lighter than this average it is made white. A small window size will make the threshold more sensitive to small changes in illuminations, is faster to compute but is adversely affected by noise in the image.
          <pre>Example</pre>A larger window size will make the threshold less sensitive to small changes in illumination, is slower to compute and less affected by noise in the image. This has the effect of making the threshold value selection more or less sensitive to small changes in pixel values.
          <pre>Example</pre>
          <pre>
The window does not need to be square.  for example...
  magick input.png -lat 15x25 output.png
</pre>You can also provide an offset which will be added to the calculated average color, making the local threshold value for each pixel either lighter or darker. This can be used for example to reduce the effect of noise or the effect of small changes in pixel values.
          <pre>
  magick input.png -lat 15x25+2%
</pre>These small changes normally occur when a scanner or digital camera is used to acquire the image. Use a positive offset value to make the adaptive thresholding less sensitive to small variations in pixel values. Use a negative threshold to make the adaptive threshold more sensitive to small variations in pixel values. Alternatively, one could reduce the noise in the image before processing it with "-lat".
          <pre>
In summary, each pixel is thresholded using the following logic:
  AVG = average value of each pixel in the window
  IF (input pixel is &gt; AVG + OFFSET)
     Output pixel is BLACK
  else
     Output pixel is WHITE

---

An alternative is to subtract a blurred copy of the original image
using (Modulus) Subtraction, then thresholding.

   magick rose: -colorspace gray -lat 10x10+0% x:

is roughly equivalent to...

   magick rose: -colorspace gray \( +clone -blur 10x65535 \) \
           -compose subtract -composite -threshold 50%  x:

The special "-blur 10x65535"  is a linear averaging blur limiting itself to a
10x10 window.

The 'Subtract' composition being a mathematical modulus type of operation will
wrap the values that goes negative back round to a value greater than 50%.

If you want to include an offset you can do so by also subtracting a solid
color background image by using a -flatten...  for example

   magick rose: -colorspace gray -lat 10x10+10% x:

is roughly equivalent to...

   magick rose: -colorspace gray \( +clone -blur 10x65535 \) \
           -compose subtract -background gray10 -flatten -threshold 50%  x:

</pre>The above was modified from initial notes provided by D Hobson &lt;dhobson@yahoo.com&gt;
          <hr width="30%">
          <!-- ------------ -->
          <pre>
   -adaptive-sharpen
        Sharpen images only around the edges of the images

   -segment cluster-threshold x smoothing-threshold
         Segmentation of the color space (not image objects)
         This can produce very verbose output.
         This applies the "fuzzy c-means algorithm" if you want to know more.

Also related is -despeckle. to remove single off color pixels.

Generate a 3d stereogram of two images (one for each eye)
This is also known as an anaglyph
  magick composite left.jpg right.jpg -stereo anaglyph.jpg

</pre>
          <hr>
          <!-- ---------------------------------------------------------------- -->
          <a name="shade" id="shade"></a>
          <h2>Shade 3D Highlighting</h2>
          <h3>Shade Usage</h3>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" operator I have always thought one of the most interesting operators provided by ImageMagick. The documentation of this operator only gave a rough hint as to its capabilities. It too me a lot of personal research to make sense of the operator, and even figure out how best to use the power that it can provide IM users. Basically what this operator does is assume that the given image is something called a 'height field'. That is, a grey-scale image representing the surface of some object, or terrain. The color '<code>white</code>' represents the highest point in an image, while '<code>black</code>' the lowest point. This representation come out of the 1980 computer vision research, where a photo with a strong 'camera light' was used, making near points bright, and points far away dark.
          <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
            <tr valign="top">
              <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
              <td align="justify" width="100%"><font size="-1"><i>As a grey-scale image is needed by "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>", the operator will automatically remove any color from the input image. Similarly any transparency that may be present in the image is completely useless and ignored by the operator.</i></font></td>
            </tr>
          </table>Now "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" takes this grey-scale height field and shines a light down onto it. The result is a representation of light shades that would thus be produced. Remember you must think of the input image as a 'surface' for the output to make any sense. For our demonstrations we will need a 'height field' image so lets draw one.
          <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
            <tr>
              <td width="100%" align="justify">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -font Candice -pointsize 64 -background black -fill white \
          label:A  -trim +repage -bordercolor black -border 10x5 \
          shade_a_mask.gif
</samp></pre>
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <a href="shade_a_mask.gif"><img src="shade_a_mask.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
              </td>
            </tr>
          </table>This image is also equivalent of a 'mask' of a shape, is often not only used as input to "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>", but also for <a href="../masking/#masks">Masking Images</a> to cut out the same shape from the shaded results. See <a href="#shade_mask">Masking a Shade Image</a> below. To the "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" operator this image will look like a flat black plain, with a flat white plateau rising vertically upward. Only the edges of this image will thus produce interesting effects. To this effect the two arguments defines the direction from which the light is shining. The first argument is the <i>direction</i> from which the light comes. As such a '<code>0</code>' degree angle will be from the east (of left), '<code>90</code>' is anti-clockwise from the north (or top), and so on. For example...
          <div align="center">
            <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
              <tr>
                <td>
                  <pre class="bg-light text-dark mx-4"><samp>
  magick shade_a_mask.gif   -shade    0x45   shade_direction_0.gif
  magick shade_a_mask.gif   -shade   45x45   shade_direction_45.gif
  magick shade_a_mask.gif   -shade   90x45   shade_direction_90.gif
  magick shade_a_mask.gif   -shade  135x45   shade_direction_135.gif
  magick shade_a_mask.gif   -shade  180x45   shade_direction_180.gif
</samp></pre>
                </td>
              </tr>
            </table>You get the idea. The light can come from any direction. The other argument is the <i>elevation</i>, and represents angle the light source makes with the ground. You can think of it as how high the sun is during the day, so that '0' is dawn, and '90' is directly overhead.
            <div align="center"><img src="../img_diagrams/shade_elevation.gif" width="300" height="170" align="middle" vspace="2" hspace="5" alt="[diagram]"></div>
            <div align="center">
              <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                <tr>
                  <td>
                    <pre class="bg-light text-dark mx-4"><samp>
  magick shade_a_mask.gif   -shade  90x0    shade_elevation_0.gif
  magick shade_a_mask.gif   -shade  90x15   shade_elevation_15.gif
  magick shade_a_mask.gif   -shade  90x30   shade_elevation_30.gif
  magick shade_a_mask.gif   -shade  90x45   shade_elevation_45.gif
  magick shade_a_mask.gif   -shade  90x60   shade_elevation_60.gif
  magick shade_a_mask.gif   -shade  90x75   shade_elevation_75.gif
  magick shade_a_mask.gif   -shade  90x90   shade_elevation_90.gif
</samp></pre>
                  </td>
                </tr>
              </table>
            </div>As you can see with an <i>elevation</i>of '<code>0</code>' the shape is only highlighted on the side from which the light is coming. Everything else is black, as no light shines on any other surface. I call this a 'Dawn Highlight' and has its own special uses. This brings us to the first item of note. An image that is "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" will often have more dark, or shadowed areas, than highlighted areas. The shading is not equal. As the light gets higher over the 'height field' image. The overall brightness of the image will become whiter, until at 'high-noon' or an <i>elevation</i>of '<code>90</code>' any flat areas are brilliantly white, and only slopes and edges are shaded to a grey color, with a mid grey as a maximum, or 'cliff-like' slope change. This 'noon' image is another special case that is a bit like an edge detection system, though it is between 2 and 4 pixels wide for sharp edges. I have used this image in the past for generating a mask for the the beveled edge of "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" images, so as to make flat areas transparent. If the <i>elevation</i>angle goes beyond '<code>90</code>' degrees, you will get the same result as if the light was from the other direction. As such the argument '<code>0x135</code>' will produce exactly the same result as '<code>180x45</code>'. A negative <i>elevation</i>angle will also produce the same results, as if the light is coming up from below, onto a 'translucent' like surface. As such '<code>0x-45</code>' will be the same as '<code>0x45</code>'. In other words for a particular shade there are usually 4 other arguments that will also produce the same result. From the above I would consider an argument of '<code>120x45</code>' to be about the best for direct use of the shade output. For example, here it creates some beveled text...
            <div align="center">
              <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                <tr>
                  <td>
                    <pre class="bg-light text-dark mx-4"><samp>
  magick -size 320x100 xc:black \
          -font Candice -pointsize 72 -fill white \
          -draw "text 25,65 'Anthony'" \
          -shade 120x45  shade_anthony.jpg
</samp></pre>
                  </td>
                </tr>
              </table><a href="shade_anthony.jpg"><img src="shade_anthony.jpg" width="320" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
            </div>One of the major problems with "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" is the thickness of the bevel that is actually produced. A sharp edge such as I used above will always produce a bevel of about 4 pixels wide, both into and out of the masked area. There is no way to adjust this thickness, short of resizing images before and after using the "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" operator.. If you would like to find out just how bright 'flat areas' will be from a specific <i>elevation</i>lighting angle, then you can use the following command, to shade a flat solid color surface.
            <div align="center">
              <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                <tr>
                  <td>
                    <pre><code execute="" out="shade_elevation_45.txt">
  magick -size 50x50 xc:white -draw 'circle 25,25 20,10' \
          -blur 0x2  -shade 0x45   -gravity center -crop 1x1+0+0 txt:-
</code></pre>
                  </td>
                </tr>
              </table><a href="shade_elevation_45.txt"><img src="shade_elevation_45.txt.gif" align="middle" vspace="0" hspace="0" border="0" alt="[IM Text]"></a>
            </div>As you can see a <i>elevation</i>of '<code>45</code>' degrees produces a quite bright flat color of about 70% grey, which is a reasonable grey level for general viewing. However if you plan to use shade for generating 3-D highlights of various shapes, then the actual grey level becomes very important. This will be looking at later in <a href="#shade_overlay">Creating Overlay Highlights</a>. That is, basically it, for the "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" operator. However using it effectively presents a whole range of techniques and possibilities, which we will look at next. <a name="shade_mask" id="shade_mask"></a>
            <h3>Masking Shaded Shapes</h3>As mentioned above, a simple 'mask' shape is often used with "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" to generate complex 3-D effects from a simple shape. For example lets do this to a directly shaded mask image.
            <div align="center">
              <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                <tr>
                  <td>
                    <pre class="bg-light text-dark mx-4"><samp>
  magick shade_direction_135.gif  shade_a_mask.gif \
          -alpha Off -compose CopyOpacity -composite   shade_beveled.png
</samp></pre>
                  </td>
                </tr>
              </table><a href="shade_direction_135.gif"><img src="shade_direction_135.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" align="middle" width="20" height="20" alt=" + "> <a href="shade_a_mask.gif"><img src="shade_a_mask.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="shade_beveled.png"><img src="shade_beveled.png" align="middle" vspace="5" hspace="5" border="0" alt="[IM Output]"></a>
            </div>Notice that about half the bevel generated by the "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" operator, actually falls outside the masked area. In other words, a straight bevel is halved when masked. On the other hand the vertical or 'midday' shade image (using '<code>90</code>' degree <i>elevation</i>angle) can be used to just extract the beveled edge, leaving the center of the image hollow.
            <div align="center">
              <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                <tr>
                  <td>
                    <pre class="bg-light text-dark mx-4"><samp>
  magick shade_direction_135.gif \
          \( shade_elevation_90.gif -normalize -negate \) \
          -alpha Off -compose CopyOpacity -composite   shade_beveled_edge.png
</samp></pre>
                  </td>
                </tr>
              </table><a href="shade_direction_135.gif"><img src="shade_direction_135.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" align="middle" width="20" height="20" alt=" + "> <a href="shade_elevation_90.gif"><img src="shade_elevation_90.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="shade_beveled_edge.png"><img src="shade_beveled_edge.png" align="middle" vspace="5" hspace="5" border="0" alt="[IM Output]"></a>
            </div>Note however that the 'midday' shade image, while providing a way to mask the location (and intensity) of the effects of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" operator does not actually cover those effects completely. By combining the 'midday' shade image with the original mask you can increase the size of that mask slightly to produce a better masked beveled image.
            <table>
              <tr>
                <td>
                  <a href="shade_a_mask.gif"><img src="shade_a_mask.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="shade_direction_0.gif"><img src="shade_direction_0.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_direction_45.gif"><img src="shade_direction_45.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_direction_90.gif"><img src="shade_direction_90.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_direction_135.gif"><img src="shade_direction_135.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_direction_180.gif"><img src="shade_direction_180.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a>
                </td>
              </tr>
              <tr>
                <td>
                  <a href="shade_elevation_0.gif"><img src="shade_elevation_0.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_elevation_15.gif"><img src="shade_elevation_15.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_elevation_30.gif"><img src="shade_elevation_30.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_elevation_45.gif"><img src="shade_elevation_45.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_elevation_60.gif"><img src="shade_elevation_60.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_elevation_75.gif"><img src="shade_elevation_75.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a> <a href="shade_elevation_90.gif"><img src="shade_elevation_90.gif" align="middle" vspace="5" hspace="2" border="1" alt="[IM Output]"></a>
                </td>
              </tr>
              <tr>
                <td width="100%" align="justify">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick shade_direction_135.gif \
          \( shade_elevation_90.gif -normalize -negate \
             shade_a_mask.gif -compose screen -composite \) \
          -alpha Off -compose CopyOpacity -composite   shade_beveled_plus.png
</samp></pre>
                      </td>
                    </tr>
                  </table>
                </td>
                <td>
                  <a href="shade_beveled_plus.png"><img src="shade_beveled_plus.png" align="middle" vspace="5" hspace="5" border="0" alt="[IM Output]"></a>
                </td>
              </tr>
            </table>Remember with IM v6 you can generate the 'shade' image I generated previously all in the same command. As such the above could have been completely generated from scratch. For example.
            <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
              <tr>
                <td width="100%" align="justify">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick -font Candice -pointsize 72 -background black -fill white \
          label:X  -trim +repage -bordercolor black -border 10x5 \
          \( -clone 0 -shade  135x45 \) \
          \( -clone 0 -shade  0x90  -normalize -negate \
             -clone 0 -compose screen -composite \) \
          -delete 0 -alpha Off -compose CopyOpacity -composite \
          shade_beveled_X.png
</samp></pre>
                      </td>
                    </tr>
                  </table>
                </td>
                <td>
                  <a href="shade_beveled_X.png"><img src="shade_beveled_X.png" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
                </td>
              </tr>
            </table><a name="shade_shape" id="shade_shape"></a>
            <h3>Shaded Shape Images</h3>The <a href="../masking/#alpha_extract">Alpha Extract Operator</a> will not only extract the alpha channel from a shaped images as a gray scale mask, but also has the side effect of preserving the shape in the 'turned-off' alpha channel. As it is 'turned off' it will not be touched by many image processing operators, including "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>", preserving its detail. What this means is that for shaped images, you can extract the shape, do the work, then simply recover the transparency AFTER you have finished all the image processing, simply by turning the <a href="../basics/#alpha_on">Alpha On</a> again! For example, here I draw a 'Heart' on a transparent background, do some blurring and shading of the image, then restore the original shaped outline of the image.
            <table border="0" cellspacing="0" cellpadding="0" width="100%" align="center">
              <tr>
                <td width="100%" align="justify">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick -size 100x100 -gravity center -background None \
          -font WebDings label:Y \
          -alpha Extract -blur 0x6 -shade 120x21 -alpha On \
          -normalize +level 15%  -fill Red -tint 100%    shade_heart.png
</samp></pre>
                      </td>
                    </tr>
                  </table>
                </td>
                <td>
                  <a href="shade_heart.png"><img src="shade_heart.png" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
                </td>
              </tr>
            </table>All I can say is WOW, what a time saver! A lot simplier than the previous command with all its extra processing and image cloning. <a name="shade_blur" id="shade_blur"></a>
            <h3>Rounding Shade Edges</h3>As you saw in the last example, by blurring the image shape mask, the 'slope' of edge 'cliffs' will be smoothed out, as if worn down by time. This produces a nice rounded effect to the shade image.
            <div align="center">
              <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                <tr>
                  <td>
                    <pre class="bg-light text-dark mx-4"><samp>
  magick -size 50x50 xc:black -fill white -draw 'circle 25,25 20,10' \
          shade_circle_mask.gif
  magick shade_circle_mask.gif            -shade 120x45  shade_blur_0.gif
  magick shade_circle_mask.gif -blur 0x1  -shade 120x45  shade_blur_1.gif
  magick shade_circle_mask.gif -blur 0x2  -shade 120x45  shade_blur_2.gif
  magick shade_circle_mask.gif -blur 0x3  -shade 120x45  shade_blur_3.gif
  magick shade_circle_mask.gif -blur 0x4  -shade 120x45  shade_blur_4.gif
  magick shade_circle_mask.gif -blur 0x5  -shade 120x45  shade_blur_5.gif
</samp></pre>
                  </td>
                </tr>
              </table>As you can see blurring not only rounds-off the edges, but makes the lighting effects dimmer. You can maximize the contrast of the result by normalizing the it, so as to bring the brightest and darkest points back to pure white and black colors respectively.
              <div align="center">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick shade_blur_3.gif   -normalize  shade_blur_3n.gif
</samp></pre>
                    </td>
                  </tr>
                </table><a href="shade_blur_3.gif"><img src="shade_blur_3.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="shade_blur_3n.gif"><img src="shade_blur_3n.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
              </div>The only draw back with this is that this also generally darkens the shaded image. This is something which we'll need to take into account in <a href="#shade_overlay">Creating Overlay Highlights</a>. Lets finish off this shade image by directly masking it as well..
              <div align="center">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick shade_blur_3n.gif shade_circle_mask.gif \
          -alpha Off -compose CopyOpacity -composite   shade_blur_3n_mask.png
</samp></pre>
                    </td>
                  </tr>
                </table><a href="shade_blur_3n.gif"><img src="shade_blur_3n.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="shade_blur_3n_mask.png"><img src="shade_blur_3n_mask.png" width="50" height="50" align="middle" vspace="5" hspace="5" border="0" alt="[IM Output]"></a>
              </div>As you can see blurring the mask image will round off the edges of the resulting shape very nicely. <a name="shade_overlay" id="shade_overlay"></a>
              <h3>Creating Overlay Highlighting</h3>The output from the "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" operator is very nice, but it is rare that you actually want a plain grey scale image of your shape. What is needs is some color. This however is not so easy as the two major ways of adding color, <a href="../color_mods/#tint">Color Tinting Mid-Tones</a>to just recolor a grey-scale, or '<a href="../compose/#overlay">Overlay</a>' alpha composition, to replace the grey areas with an image, both rely on a special form of grey-scale image. That is, a perfect mid-tone grey ('<code>grey50</code>') is replaced by the color or image, while whiter or darker greys, whiten and darken the color or image as appropriate. These special grey-scale 'overlay highlight' images with perfect mid-tone greys for un-modified areas is not so straight forward to create using "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>". However the following are some of the more simpler ways I have discovered. Using a 30 degree elevation lighting angle with "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>", is one way of producing a perfect mid-tone grey for flat areas of the shape being shaded. For example, here I shade an image, then extract the top-left pixel to check the resulting color of a 'flat' part of the image.
              <table>
                <tr>
                  <td>
                    <a href="shade_circle_mask.gif"><img src="shade_circle_mask.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="shade_blur_0.gif"><img src="shade_blur_0.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="shade_blur_1.gif"><img src="shade_blur_1.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="shade_blur_2.gif"><img src="shade_blur_2.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="shade_blur_3.gif"><img src="shade_blur_3.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="shade_blur_4.gif"><img src="shade_blur_4.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="shade_blur_5.gif"><img src="shade_blur_5.gif" width="50" height="50" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                  </td>
                </tr>
                <tr valign="top">
                  <td width="10%" align="justify" rowspan="2"></td>
                  <td width="90%" align="justify">
                    <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                      <tr>
                        <td>
                          <pre><code execute="" out="shade_30.txt">
  magick -size 50x50 xc:black -fill white -draw 'circle 25,25 20,10' \
          -blur 0x2  -shade 120x30           shade_30.png
  magick shade_30.png   -gravity center -crop 1x1+0+0 txt:-
</code></pre>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td align="center" rowspan="2">
                    <a href="shade_30.png"><img src="shade_30.png" align="middle" vspace="20" hspace="0" border="0" alt="[IM Image]"></a>
                  </td>
                </tr>
                <tr>
                  <td>
                    <table border="0" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                      <tr>
                        <td>
                          <a href="shade_30.txt"><img src="shade_30.txt.gif" align="middle" vspace="0" hspace="0" border="0" alt="[IM Text]"></a>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>Unfortunately changing the rounding effect of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#blur">-blur</a></code>" in the above command tends to also vary the result highlight intensity of the shade image. That is, using a large blur not only produces a well rounded looking edge, but also made the highlight so dim as to be near invisible. This means that you need to add lots more contrast to the output of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>" image produced, to make the highlight effective as an overlay image. To fix this we need a way remove this contrast effect from the rounding adjustment. The typical way to do this is to just "<code><a href="https://imagemagick.org/script/command-line-options.php?#normalize">-normalize</a></code>" the image, but doing this to 30 degree shade image, results in the 'flat' areas will no longer being a perfect grey. For example...
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
                <tr valign="top">
                  <td width="10%" align="justify" rowspan="2"></td>
                  <td width="90%" align="justify">
                    <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                      <tr>
                        <td>
                          <pre><code execute="" out="shade_30_norm.txt">
  magick -size 50x50 xc:black -fill white -draw 'circle 25,25 20,10' \
          -blur 0x2  -shade 120x30 -normalize   shade_30_norm.png
  magick shade_30_norm.png   -gravity center -crop 1x1+0+0 txt:-
</code></pre>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td align="center" rowspan="2">
                    <a href="shade_30_norm.png"><img src="shade_30_norm.png" align="middle" vspace="20" hspace="0" border="0" alt="[IM Image]"></a>
                  </td>
                </tr>
                <tr>
                  <td>
                    <table border="0" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                      <tr>
                        <td>
                          <a href="shade_30_norm.txt"><img src="shade_30_norm.txt.gif" align="middle" vspace="0" hspace="0" border="0" alt="[IM Text]"></a>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>After some further experimentation however I found that using a 21.78 degree shade elevation angle, will after being normalized, produce the desired perfect mid-tone grey level as well as a good strong highlighting effect.
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
                <tr valign="top">
                  <td width="10%" align="justify" rowspan="2"></td>
                  <td width="90%" align="justify">
                    <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                      <tr>
                        <td>
                          <pre><code execute="" out="shade_21_norm.txt">
  magick -size 50x50 xc:black -fill white -draw 'circle 25,25 20,10' \
          -blur 0x2  -shade 120x21.78 -normalize   shade_21_norm.png
  magick shade_21_norm.png   -gravity center -crop 1x1+0+0 txt:-
</code></pre>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td align="center" rowspan="2">
                    <a href="shade_21_norm.png"><img src="shade_21_norm.png" align="middle" vspace="20" hspace="0" border="0" alt="[IM Image]"></a>
                  </td>
                </tr>
                <tr>
                  <td>
                    <table border="0" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                      <tr>
                        <td>
                          <a href="shade_21_norm.txt"><img src="shade_21_norm.txt.gif" align="middle" vspace="0" hspace="0" border="0" alt="[IM Text]"></a>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>As the shade image is now run though the "<code><a href="https://imagemagick.org/script/command-line-options.php?#normalize">-normalize</a></code>" operator, the "<code><a href="https://imagemagick.org/script/command-line-options.php?#blur">-blur</a></code>" value used for 'rounding edges' will no longer effect final intensity of the result. A much better method. In summery, <a href="https://imagemagick.org/script/command-line-options.php?#normalize">normalizing</a> a shade image will shift the mid-tones away from a perfect-grey color. Now we can adjust the output intensity of the highlights produces output completely independent to the other adjustments. Typically as the normalized result is extreme, we will need a controlled de-normalization, or anti-contrast control, to reduce the highlight to the desired level. The simplest method for adjusting the resulting highlight, is to <a href="../color_mods/#tinting">color tint</a> the image with a perfect grey. This will shift all the color levels in the image toward the central pure mid-tone grey color. For example...
              <div align="center">
                <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                  <tr>
                    <td>
                      <pre class="bg-light text-dark mx-4"><samp>
  magick -size 50x50 xc:black -fill white -draw 'circle 25,25 20,10' \
          \( +clone -blur 0x2 -shade 120x21.78 -normalize  \) \
          +swap -alpha Off -compose CopyOpacity -composite  shade_tint_0.png
  magick shade_tint_0.png -fill grey50  -colorize 10%  shade_tint_10.png
  magick shade_tint_0.png -fill grey50  -colorize 30%  shade_tint_30.png
  magick shade_tint_0.png -fill grey50  -colorize 50%  shade_tint_50.png
  magick shade_tint_0.png -fill grey50  -colorize 80%  shade_tint_80.png
</samp></pre>
                    </td>
                  </tr>
                </table>An alternative to just linearly tinting the highlight, is to reduce its general effect while preserving the extreme bright/dark spots of the highlight by using <a href="../color_mods/#sigmoidal">Sigmoidal Non-liner Contrast</a>instead. This should give a more 'natural' look to the highlight effect, and can make the highlight brighter, as if the surface was more reflective. However to make this technique more effective, we need make sure we do not have pure white and black colors in the shade result. This can be achieved by first using a "<code><a href="https://imagemagick.org/script/command-line-options.php?#contrast-stretch">-contrast-stretch</a></code>" of '<code>0%</code>' rather than "<code><a href="https://imagemagick.org/script/command-line-options.php?#normalize">-normalize</a></code>", and also de-normalizing that result by a small amount, as we did above. This may seem to be just adding complexity to the generation of the highlight overlay image, but emphasizing the bright spots in the highlight makes the extra processing worth the effort. For example...
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick -size 50x50 xc:black -fill white -draw 'circle 25,25 20,10' \
          \( +clone -blur 0x2 -shade 120x21.78 -contrast-stretch 0% \) \
          +swap -alpha Off -compose CopyOpacity -composite shade_sig_0.png

  magick shade_sig_0.png  -sigmoidal-contrast 10x50%  shade_sig-10.png
  magick shade_sig_0.png  -sigmoidal-contrast  5x50%  shade_sig-5.png
  magick shade_sig_0.png  -sigmoidal-contrast  2x50%  shade_sig-2.png

  magick shade_sig_0.png  +sigmoidal-contrast  2x50%  shade_sig+2.png
  magick shade_sig_0.png  +sigmoidal-contrast  5x50%  shade_sig+5.png
  magick shade_sig_0.png  +sigmoidal-contrast 10x50%  shade_sig+10.png
</samp></pre>
                      </td>
                    </tr>
                  </table>
                </div>As you can see that the overall highlighting is reduced in intensity, but the bright spot from reflected light remains as bright as ever, just reduced in size. The result is a much more natural 'shiny' look to the shape. The only drawback with this technique is that a shadow 'spot' is also generated though this is often not as noticeable. Finally we can combine the a 'highlight spot' with a general highlight reduction to produce a highly configurable set of highlight overlay generator controls...
                <table>
                  <tr>
                    <td>
                      <a href="shade_tint_0.png"><img src="shade_tint_0.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="shade_tint_10.png"><img src="shade_tint_10.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <a href="shade_tint_30.png"><img src="shade_tint_30.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <a href="shade_tint_50.png"><img src="shade_tint_50.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <a href="shade_tint_80.png"><img src="shade_tint_80.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <a href="shade_sig-10.png"><img src="shade_sig-10.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <a href="shade_sig-5.png"><img src="shade_sig-5.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <a href="shade_sig-2.png"><img src="shade_sig-2.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <img src="../img_www/left.gif" align="middle" width="20" height="20" alt="&lt;=="> <a href="shade_sig_0.png"><img src="shade_sig_0.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <img src="../img_www/right.gif" align="middle" width="20" height="20" alt="==&gt;"> <a href="shade_sig+2.png"><img src="shade_sig+2.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <a href="shade_sig+5.png"><img src="shade_sig+5.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a> <a href="shade_sig+10.png"><img src="shade_sig+10.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a>
                    </td>
                  </tr>
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick -size 50x50 xc:black -fill white -draw 'circle 25,25 20,10' \
          \( +clone -blur 0x4 -shade 120x21.78 -contrast-stretch 0% \
             +sigmoidal-contrast 7x50% -fill grey50 -colorize 10%  \) \
          +swap -alpha Off -compose CopyOpacity -composite shade_overlay.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="shade_overlay.png"><img src="shade_overlay.png" align="middle" vspace="0" hspace="0" border="0" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>
                <dl>
                  <dt>In summary, the above example has four separate controls...</dt>
                  <dd>"<code><a href="https://imagemagick.org/script/command-line-options.php?#blur">blur</a></code>" : Rounding the shape edges (0.001=beveled 2=smoothed 10=rounded)</dd>
                  <dd>"<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">shade</a></code>" : The direction the light is coming from (120=top-left 60=top-right)</dd>
                  <dd>"<code><a href="https://imagemagick.org/script/command-line-options.php?#sigmoidal-contrast">sigmoidal</a></code>" : surface reflective control highlight spots (1=flat 5=good 10=reflective )</dd>
                  <dd>"<code><a href="https://imagemagick.org/script/command-line-options.php?#colorize">colorize</a></code>" : Overall contrast of the highlight ( 0%=bright 10%=good 50%=dim )</dd>
                </dl>Note while the above examples have been shaped to the original 'circle' shape, the transparency should only be restored AFTER '<a href="../compose/#overlay">Overlay</a>' compositing has been applied, not before. Also if you plan to use a highlight repeatedly on the same shape (after any rotation is performed), you can pre-generate the highlight overlay once for each shape you plan to use, saving the result for multiple re-use. An example of this re-use of shading overlay is with the generation of 3D DVD covers from flat source images in the <a href="https://magick.imagemagick.org/viewtopic.php?t=11726">IM Discussion Forums</a>. I also highly recommend you experiment with the above techniques, as they are key to making your flat shaped images, much more realistic looking. If you come up with other ideas for highlighting, please let me know.
                <pre>
FUTURE:
   Color Tinting the Overlay image
   Overlay Alpha Composition with an Image
</pre><a name="shade_highlight" id="shade_highlight"></a>
                <h3>Using a Dawn Shade Highlight</h3>In <a href="#shade_mask">Masking Shade Images</a> above we showed how useful a 'mid-day' or 'high-noon' shade image (using an <i>elevation</i> of '<code>90</code>'), can be useful for masking and location and extent of the effects produced by "<code><a href="https://imagemagick.org/script/command-line-options.php?#shade">-shade</a></code>. However the horizontal or 'dawn' shade images (using an <i>elevation</i> of '<code>0</code>')of a shape can also be quite useful as well. It can for example be used as a mask for either white or black images to generate separate highlight and shading effects on shapes. This also can be used ensure a shape gets roughly equal amounts of light and dark areas (or even unequal amounts), as I produce them in seperatally but in a completely controled way.
                <pre>FUTURE: more detail here</pre>See the first <a href="../advanced/#3d-logos">Advanced 3D Logo</a> for an example of using this technique.
                <hr>
                <!-- ---------------------------------------------------------------- -->
                <a name="fx" id="fx">
                <h2>Using FX, The DIY Image Operator</h2></a> The image list operator "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" is a general DIY operator that does not fit into any specific category of IM operators, as it can be used to create just about any image operation. Examples of its use are thought these pages, but here we will look specifically at its capabilities and how you can use them. The command is so generic in its abilities, that it can,
                <ul>
                  <li>create canvases, gradients, mathematical colormaps.</li>
                  <li>move color values between images and channels.</li>
                  <li>adjust image colors in just about any way imaginable</li>
                  <li>translate, flip, mirror, rotate, scale, shear and generally distort images.</li>
                  <li>merge or composite multiple images together.</li>
                  <li>tile image(s) in weird and wonderful ways.</li>
                  <li>convolve or merge neighboring pixels together.</li>
                  <li>generate image metrics or 'fingerprints'</li>
                  <li>compare images in unusual ways.</li>
                </ul>Of course many of these techniques are already part of IM, producing a faster and more flexible result. But if it isn't built-in the "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" allows you to generate your own version of the desired operation. In fact I and others have often used it to prototype new operations that are later built into IM's core library. As an example see <a href="../bugs/ordered-dither/#diy">DIY New Ordered Dither Replacement</a> where I used "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" to develop a revised version of the <code><a href="https://imagemagick.org/script/command-line-options.php?#ordered-dither">-ordered-dither</a></code>" operator. The operator is essentially allows you to perform free-form mathematical operations on one or more images. For the official summary of the command see <a href="https://imagemagick.org/script/fx.php">FX, The Special Effects Image Operator</a> on the <a href="https://imagemagick.org/">ImageMagick Web Site</a>.
                <h3>FX Basic Usage</h3>The command takes an image sequence of as many input images you like. Typically one or two images, and replaces ALL the input images with a copy of the first image, which has been modified by the results of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" function. That is, any meta-data that is in the first image will be preserved in the result of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" operator.For mathematical ease of use, all color values provided are normalized into a 0.0 to 1.0 range of values. Results are also expected to be in this range. This includes the transparency or alpha channel, which goes from 0.0 (meaning fully transparent) to 1.0 (meaning fully opaque). The values represent 'alpha transparency' and is actually the negative of how IM normally stores the transparency internally (as matte values). It is however more mathematically correct and easier to use in this form. The "<code><a href="https://imagemagick.org/script/command-line-options.php?#channel">-channel</a></code>" setting defines what channel(s) in the first (also called the 'zeroth' or "<code>u</code>") image, is replaced with the result of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" operator. This is limited, by default, to just the color channels ('<code>RGB</code>') of the original image. Any existing transparency in that image will not be modified, unless the "<code><a href="https://imagemagick.org/script/command-line-options.php?#channel">-channel</a></code>" setting is changed, to include the alpha ('<code>A</code>') channel. The expression is executed once for each pixel, as well an once for each color channel in the pixel that is being processed. Also as the expression is re-parsed each time it is executed, a complex expression could take some time to process on a large image. For example, here we define a black image, but then set the blue channel to be half-bright to form a 'navy blue' color instead.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick -size 64x64 xc:black -channel blue -fx '1/2' fx_navy.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_navy.gif"><img src="fx_navy.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>And here we we take a black-white gradient, and then set the blue and green channels to zero, so it becomes a black-red gradient.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick -size 64x64 gradient:black-white \
           -channel blue,green    -fx '0'    fx_red.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_red.gif"><img src="fx_red.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>
                <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
                  <tr valign="top">
                    <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
                    <td align="justify" width="100%"><font size="-1"><i>To make the "<a href="https://imagemagick.org/script/command-line-options.php?#channel"><code>-channel</code></a>" setting more like the "<a href="https://imagemagick.org/script/command-line-options.php?#fx"><code>-fx</code></a>" operator, it will accept any combinations of the letters '<code>RGBA</code>' to specify the channels to which operators are to confine their actions.<br>
                    <br>
                    This means that to limit the output of "<a href="https://imagemagick.org/script/command-line-options.php?#fx"><code>-fx</code></a>" to just the blue and green channels you can now say "<code>-channel BG</code>" instead of the longer "<code>-channel blue,green</code>".</i></font></td>
                  </tr>
                </table>We could have generated the above examples without using "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>", but being able to do this to an existing image is what makes this a powerful image operator. The function can in fact read and use ANY pixel, or specific color from ANY of the images already in the current image sequence in memory. The first 'zero' image, is given the special name of "<code>u</code>". The second image "<code>v</code>". Other images in memory can be referenced by an index. As such "<code>u[3]</code>" is the fourth image in the current image sequence, while "<code>u[-1]</code>" is the last image in the sequence. This is the same indexing scheme used by the <a href="../basics/#list_ops">Image List Operators</a>, so you should be right at home. If no other qualifiers are given, the color value used is same color used in the image specified. That is, unless you specifically say you want to use the red color, it will use the color value for the color channel the command is processing at that time. That is, it will apply the expression for the blue color value when it is processing the blue channel. Unless told otherwise it will process each of the RGB color values (as set by the default "<code><a href="https://imagemagick.org/script/command-line-options.php?#channel">-channel</a></code>" setting), for each and every pixel in the image. That is, 3*w*h calculations which modifies all the values in the image by the expression given. For example, here we take the IM built-in "<code>rose:</code>" image and multiply all pixel values by 50%.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -fx 'u*1.5'    fx_rose_brighten.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_rose_brighten.gif"><img src="fx_rose_brighten.gif" width="70" height="46" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>In the above example, each of the individual red, green and blue values was multiplied by 1.5. If the resulting value is outside the 0 to 1 range it, will be limited to the appropriate bound (1.0 in this case), unless you are using the default <a href="https://imagemagick.org/script/high-dynamic-range.php" target="_blank">HDRI version of ImageMagick</a>. Lots of other "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" formulas to recolor images are explored in <a href="../color_mods/#linear">Mathematical Color Adjustments</a> and <a href="../color_mods/#curves">Histogram Curves</a>. As we can also reference any image in the current image sequence, as part of the expression for modifing the first image, we can merge two, or even more images, in just about any way we want. Here we generate a black-red-blue color chart image, by copying the blue channel from a black-blue gradient (rotated), into the previous black-red gradient we generated above.
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick -size 64x64 gradient:black-blue -rotate -90  fx_blue.gif
  magick fx_red.gif  fx_blue.gif \
          -channel B  -fx 'v'    fx_combine.gif
</samp></pre>
                      </td>
                    </tr>
                  </table><a href="fx_red.gif"><img src="fx_red.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" width="20" height="20" align="middle" alt=" + "> <a href="fx_blue.gif"><img src="fx_blue.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="fx_combine.gif"><img src="fx_combine.gif" width="64" height="64" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                </div>
                <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
                  <tr valign="top">
                    <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
                    <td align="justify" width="100%"><font size="-1"><i>Of course we could have just used a <a href="../compose/#copyblue">Channel Coping Composition Method</a> instead which would be a lot faster. But that is not point.<br>
                    <br>
                    Though the reverse is also true. Just about every IM image operation could be replaced by a FX equivelent function.<br>
                    <br></i></font></td>
                  </tr>
                </table>Now the second image in the above is only used as a source image. What really happens is that "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" first creates a copy of just the first image. It then modifies that image according to the formula, using all the other images given. And finally it junks all the input images replacing them with the modified copy of the first image. You can also calculate values based on each pixel location within the image. values '<code>i,j</code>' is the current position of the pixel being processed, while '<code>w,h</code>' gives the size of the image (the first image unless a specific image qualifier is given). For example, here we generate a <a href="../canvas/#gradient_fx">DIY Gradient Image</a>.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -channel G -fx 'sin(pi*i/w)' -separate   fx_sine_gradient.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_sine_gradient.gif"><img src="fx_sine_gradient.gif" width="70" height="46" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      Or something more complex using both '<code>i,j</code>' position values.
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick -size 80x80 xc: -channel G -fx  'sin((i-w/2)*(j-h/2)/w)/2+.5'\
          -separate fx_2d_gradient.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_2d_gradient.gif"><img src="fx_2d_gradient.gif" width="80" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>When generating gray-scale gradients, you can make the -fx operator work about 3 times faster, simply by asking it to only process one color channel, such as the '<code>G</code>' or green channel in the above example. This channel can then be <a href="../color_basics/#separate">Separated</a> to generate the final gray-scale image. This can represent a very large speed boost, especially when using a very complex "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" formula. For more FX generated gradients, see examples <a href="../canvas/#gradient_fx">Roll your own Gradients</a>. <a name="fx_simple_distorts" id="fx_simple_distorts"></a> You can use the position information to lookup specific pixels from the source image using the '<code>p{x,y}</code>' syntax. For example you can easily make your own 'mirror image' type function (like the "<code><a href="https://imagemagick.org/script/command-line-options.php?#flop">-flop</a></code>" image operator), that replaces each pixel, with the color values from the 'mirror' position of the original source.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -fx  'p{w-i-1,j}'  fx_rose_mirror.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_rose_mirror.gif"><img src="fx_rose_mirror.gif" width="70" height="46" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This type of 'image distortion' was made more powerful by creating <a href="../mapping/#distort">Distortion Image Mapping</a>, or other types of Value Lookup Tables, in the form of images. Examples of doing this has been provided in <a href="../quantize/#diy_dither">DIY Dither Patterns and Threshold Maps</a>, where FX is used to replace specific colors with patterns from other images. <a name="fx_resize" id="fx_resize"></a> Now the size of the final image generated by an FX expression is the same as the first image given, as such to generate a larger image, you will need to set the first image to the size you want. In this type of situation a second image (or even a third image) can be used as a color source (hence the <a href="../basics/#swap">Swap</a> in the next example). For example, here we resize rose image (using <a href="../resize/#interpolative-resize">Interpolated Scaling or Resize</a>) to generate a larger image.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose:  -size 120x80 xc: +swap  \
           -fx 'v.p{  (i+.5)*v.w/w-.5, (j+.5)*v.h/h-.5  }' \
           fx_scaled.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_scaled.png"><img src="fx_scaled.png" width="120" height="80" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Note how the pixel lookup is performed, it may seem complex but it is the proper way to scale (distort) an image. Basically all the extra '<code>0.5</code>' values added to the expression is needed to correctly magick between <a href="../distorts/#control_coordinates">Pixel Coodinates</a> used for input coordinates '<code>i,j</code>' and location lookup '<code>v.p{...}</code>, while the more mathematically correct <a href="../distorts/#control_coordinates">Image Coordinates</a> is needed for the actual mathematical calculations (scaling). The above is actually the exact methodology used by any form of <a href="../distorts/#distort">Image Distortion</a>. You can see this FX equivelent for most distortions by turning on the <a href="../distorts/#distort_verbose">Verbose Distortion Summery</a>. This reports a FX equivelent for most image distortions, as a way to double check the distortion is doing what it is expected to do. The use of the <a href="#fx">FX DIY Operator</a> to do image distortions, shows just how powerful this operator really is. If it wasn't for this operator I doubt may of the new operations, such as distortions, sparse-color, or ordered dithers would have been added to the ImageMagick Core Library. Here is something a little simplier, swapping the red and blue channels of the rose image. See if you can figure how it works.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: \( +clone -channel R -fx B \) \
          +swap -channel B -fx v.R     fx_rb_swap.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_rb_swap.gif"><img src="fx_rb_swap.gif" width="70" height="46" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>
                <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
                  <tr valign="top">
                    <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
                    <td align="justify" width="100%"><font size="-1"><i>A faster and better way to do the same thing, is to use "<code><a href="https://imagemagick.org/script/command-line-options.php?#separate">-separate</a></code>" and "<code><a href="https://imagemagick.org/script/command-line-options.php?#combine">-combine</a></code>"). See <a href="../color_basics/#combine">Combining RGB Channel Images</a>. Alternatively you can also use a "<code><a href="https://imagemagick.org/script/command-line-options.php?#color-matrix">-color-matrix</a></code>" to do the same thing faster still.<br>
                    <br>
                    Do you see a trend here?</i></font></td>
                  </tr>
                </table>As the default "<code><a href="https://imagemagick.org/script/command-line-options.php?#channel">-channel</a></code>" setting, it limits the output of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" operator to just the three color channels. This means that if you want to effect the alpha or transparency channel, you must explicitly specify it, by changing the channel setting. For example lets make a semi-transparent "<code>rose:</code>" image, by setting all the alpha channel values to half.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -alpha set  -channel A  -fx '0.5'    fx_rose_trans.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_rose_trans.png"><img src="fx_rose_trans.png" width="70" height="46" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Note the for the above to work properly I needed to ensure that the "<code>rose:</code>" actually had an alpha channel for the "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" to work with. I did this with the <a href="../basics/#alpha">Alpha Channel Control Operator</a>. This ability of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" operator to manipulate the RGBA channels of an image makes this operator perfect for manipulating Channels and Masks.<br>
                As of IM 6.2.10 you can add variable assignments to "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" expressions, which allows you to reduce the complexity of some expressions, that would basically be impossible any other way. For example, here I create a gradient based on the distance from a particular point (assigned to the variables '<code>xx</code>' and '<code>yy</code>'). Without the use of the variables this formula could have become very hard to read.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick -size 100x100 xc:  -channel G \
          -fx 'xx=i-w/2; yy=j-h/2; rr=hypot(xx,yy); (.5-rr/70)*1.2+.5' \
          -separate  fx_radial_gradient.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_radial_gradient.png"><img src="fx_radial_gradient.png" width="100" height="100" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>
                <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
                  <tr valign="top">
                    <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
                    <td align="justify" width="100%"><font size="-1"><i>Due the simple tokenization handling used by "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>", variable names can only consist of letters, and must not contain numbers. Also as a lot of single letters are used for internal variables accessing image information, it is recommended that variable names be at least two letters long. As such I use '<code>xx</code>' and '<code>yy</code>' rather than just '<code>x</code>' or '<code>y</code>'.</i></font></td>
                  </tr>
                </table>
                <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
                  <tr valign="top">
                    <td><img src="../img_www/warning.gif" width="28" height="28"><img src="../img_www/space.gif" width="12" height="16"></td>
                    <td align="justify" width="100%"><font size="-1"><i>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" function 'rr=<code>hypot(xx,yy)</code>' was added to IM v6.3.6 to speed up the very commonly used expression '<code>rr=sqrt(xx*xx+yy*yy)</code>'.<br>
                    <br>
                    Of course if you need the distance squared, you should avoid the '<code>hypot()</code>' function, and the sqrt() function it implies.</i></font></td>
                  </tr>
                </table>For more examples of some really complex expressions see <a href="../canvas/#gradient_complex">More Complex DIY Gradients</a>, which would be impossible with out multiple statement assignments. The same is true for <a href="../distorts/#perspective_internals">FX form of Perspective Distortion</a>. As of IM version 6.3.0-1, the complexity of "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" expressions started to require external files, so the standard '<code>@<i>filename</i></code>' can now be used to read the expression from a file.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
   echo "u*2" | magick rose: -fx "@-"  fx_file.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_file.png"><img src="fx_file.png" width="70" height="46" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This also means you can use more complex scripts to generate the specific FX expressions for a particular job. Internally the file is simply read into a string and interpreted as usual. Other settings that are important to "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" are "<code><a href="https://imagemagick.org/script/command-line-options.php?#virtual-pixel">-virtual-pixel</a></code>" and "<code><a href="https://imagemagick.org/script/command-line-options.php?#interpolate">-interpolate</a></code>". The <a href="../misc/#virtual-pixel">Virtual Pixel Setting</a> allows one to set what colors or image results should be returned when the lookup coordinates go outside the area covered by the input image. This allows one to set edge effects for things like blurs, as well as tile image over a larger area. The <a href="../misc/#interpolate">Interpolate Setting</a> allows one to specify how IM should mix colors of neighbouring pixels when the lookup coordinates (floating point values) fall between the integer coordinates of the pixels in the input image. For more information see <a href="../distorts/#lookup">Interpolated Pixel Lookup</a>.
                <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
                  <tr valign="top">
                    <td><img src="../img_www/warning.gif" width="28" height="28"><img src="../img_www/space.gif" width="12" height="16"></td>
                    <td align="justify" width="100%"><font size="-1"><i>Some More functions were added at various times<br>
                    IM v6.3.6 : hypot()<br>
                    IM v6.7.3-4 : while(), not(), guass(), squish()<br></i></font></td>
                  </tr>
                </table>
                <h3>FX Debugging</h3>The '<code>debug(<i>expr</i>)</code>' is essentially a way of printing a floating point value, each time the FX expression is calculated. This in turn provides a method of debugging your expressions. However you can limit the output from the "<code>debug()</code>" by using a tertiary if-else expression. For example this will print the floating point color values for pixel 10,10 from the built-in "<code>rose:</code>" image. The actual image result is ignored by using the '<code><a href="../files/#null">NULL:</a></code>' image handler.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre><code execute="" err="fx_debug.txt">
  magick rose: -fx 'i==10&amp;&amp;j==10?debug(u):1; u' null:
</code></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_debug.txt"><img src="fx_debug.txt.gif" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Remember the output is on standard error, not the normal standard output, that way you can use this in a command pipeline, without problems. Note how the FX expression was executed three times, once for each channel for just that one pixel. Multiply that by the number of pixels, and you can imagine the length of the output if "<code>debug()</code>" was not limited to just one pixel, even for this small image. <a name="fx_builtins" id="fx_builtins"></a>
                <h3>FX-like Built-in Operations</h3>The <code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code> operator represents a way to develop new image processing functions that previously did not exist in ImageMagick. The result of such development by users has allows ImageMagick to expand, with new functions and methods, such as the <a href="../color_mods/#clut">Color Lookup Table</a> ("<code><a href="https://imagemagick.org/script/command-line-options.php?#clut">-clut</a></code>"). Generally however once a new method has stabilized using "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>", the expression is converted into a faster built-in operation, usually added as part of a group of similar operators. These include the follow general image operator and there methods...
                <table border="0" align="center">
                  <tr valign="top">
                    <td>
                      <a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a>
                    </td>
                    <td>
                      Direct pixel, color values, channel modification functions.<br>
                      (See <a href="#evaluate">Evaluate</a> below).
                    </td>
                  </tr>
                  <tr valign="top">
                    <td>
                      <a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-function</a>
                    </td>
                    <td>
                      More Complex pixel, color value, channel modification functions.<br>
                      (See <a href="#function">Function</a> below).
                    </td>
                  </tr>
                  <tr valign="top">
                    <td>
                      <a href="https://imagemagick.org/script/command-line-options.php?#evaluate-sequence">-evaluate-sequence</a>
                    </td>
                    <td>
                      Merge a multi-image sequence of images mathematically<br>
                      (See <a href="#evaluate-sequence">Evaluate-Sequence</a> below).
                    </td>
                  </tr>
                  <tr valign="top">
                    <td>
                      <a href="https://imagemagick.org/script/command-line-options.php?#sparse-color">-sparse-color</a>
                    </td>
                    <td>
                      General Image Re-Coloring Operator.<br>
                      (See <a href="../canvas/#sparse-color">Sparse Color Gradients</a> )
                    </td>
                  </tr>
                  <tr valign="top">
                    <td>
                      <a href="https://imagemagick.org/script/command-line-options.php?#compose">-compose</a>
                    </td>
                    <td>
                      General Multi-Image combining and overlaying method.<br>
                      (See <a href="../compose/#compose">Alpha Composition</a>).
                    </td>
                  </tr>
                  <tr valign="top">
                    <td>
                      <a href="https://imagemagick.org/script/command-line-options.php?#distort">-distort</a>
                    </td>
                    <td>
                      General Image Distortion operator, using reversed pixel mapping.<br>
                      (See the <a href="../distorts/#distort">Distort Operator</a> )
                    </td>
                  </tr>
                  <tr valign="top">
                    <td>
                      <a href="https://imagemagick.org/script/command-line-options.php?#distort">-morphology</a>
                    </td>
                    <td>
                      General Area Effect Convolution/Morphology function.<br>
                      (See the <a href="../morphology/#morphology">Morphology Operator</a> and the <a href="../convolve/#convolve">Convolve Operator</a> )
                    </td>
                  </tr>
                </table>As people developed new types of image operations, they usually prototype it using a "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" operator first. When they have it worked out that 'method' is then converted into a new super-fast built-in operator in the ImageMagick Core library. Users are welcome to contribute their own "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" expressions (or other defined functions) that they believe would be a useful addition to IM, but which are not yet covered by other image operators, if they can be handled by one of the above generalized operators, it should be reasonably easy to add it. For example I myself needed a 'mask if color similar' type operation for comparing two images. This has been added as a new "<code><a href="https://imagemagick.org/script/command-line-options.php?#compose">-compose</a></code>" method "<code><a href="../compose/#changemask">ChangeMask</a></code>". This in turn allowed me to then add a more complex <a href="../anim_opt/#opt_trans">Transparency Optimization</a> for GIF animations. If "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" speed and complexity is starting to become a problem then it is probably better to move on to an API scripting language such as PerlMagick. An example of this using PerlMagick "<code><a href="https://github.com/ImageMagick/ImageMagick/blob/main/PerlMagick/demo/pixel-fx.pl">pixel_fx.pl</a></code>" is part of that API's distribution.<br>
                <a name="fx_escapes" id="fx_escapes"></a>
                <h3>FX Expressions as Format and Annotate Escapes</h3>As of IM version 6.2.10 you can now use <a href="https://imagemagick.org/script/fx.php">FX Expressions</a> within <a href="https://imagemagick.org/script/escape.php">Image Property Escaped</a> strings such as used by "<code><a href="https://imagemagick.org/script/command-line-options.php?#format">-format</a></code>" and "<code><a href="https://imagemagick.org/script/command-line-options.php?#annotate">-annotate</a></code>" arguments. The escape sequence '<code>%[fx:...]</code>' is replaced by a number as a floating point value, calculated once for each image in the current image sequence. The <a href="https://imagemagick.org/script/fx.php">FX Expression</a> however is modified slightly during processing. Specifically...
                <ul>
                  <li>The current pixel coordinates '<code>i</code>', '<code>j</code>' is fixed to the value 0, so on its own an image variable only returns the value from pixel 0,0, unless a '<code>p{}</code>' index is used.</li>
                  <li>Unless a color channel is selected only the red channel value is returned.</li>
                  <li>The default image reference '<code>s</code>' is set to current image, being annotated or identified.</li>
                  <li>The index '<code>t</code>' returns the index of the image referred to by '<code>s</code>'.</li>
                </ul>
                <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
                  <tr valign="top">
                    <td><img src="../img_www/warning.gif" width="28" height="28"><img src="../img_www/space.gif" width="12" height="16"></td>
                    <td align="justify" width="100%"><font size="-1"><i>Before IM v6.6.8-6 both FX expression values of "<code>t</code>" image index and "<code>n</code>" total number of images, were broken, and only returned a value of 0 and 1 respectively for ALL images. The same goes for the equivalent percent escapes '<code>%p</code>' and '<code>%n</code>'.</i></font></td>
                  </tr>
                </table>For example, here I "<code><a href="https://imagemagick.org/script/command-line-options.php?#annotate">-annotate</a></code>" each image with the color of the top left corner of each image.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick -size 150x25 xc:DarkRed xc:Green xc:Blue \
          -fill white -gravity center \
          -annotate 0 '%[fx:t] / %[fx:n] : %[fx:r],%[fx:g],%[fx:b]' \
          annotate_fx_%d.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="annotate_fx_0.gif"><img src="annotate_fx_0.gif" width="150" height="25" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a> <a href="annotate_fx_1.gif"><img src="annotate_fx_1.gif" width="150" height="25" align="middle" vspace="4" hspace="5" border="1" alt="[IM Output]"></a> <a href="annotate_fx_2.gif"><img src="annotate_fx_2.gif" width="150" height="25" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Notice how the text that is written is different for each image, as '<code>r</code>' is actually equivalent to '<code>s.p{0,0}.r</code>'. The same goes for the '<code>g</code>' and '<code>b</code>' color channel values. Of course each one returns a normalized value in the range of 0.0 to 1.0. To make the output of specific pixel color values easier, a '<code>%[pixel:...]</code>' escape was also added in IM v6.3.0. This operator calls the given FX expression once for each channel in each image, and formats the returned value into a color that IM can handle as a color argument.
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="800%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick -size 300x100 gradient:yellow-limegreen \
          -gravity NorthWest  -annotate 0 '%[pixel:s.p{0,0}]' \
          -gravity Center     -annotate 0 '%[pixel:s.p{0,50}]' \
          -gravity SouthEast  -annotate 0 '%[pixel:s.p{0,99}]' \
          annotate_pixel.gif
</samp></pre>
                      </td>
                    </tr>
                  </table><a href="annotate_pixel.gif"><img src="annotate_pixel.gif" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                </div>You can just output the result directly using a "<code><a href="https://imagemagick.org/script/command-line-options.php?#format">-format</a></code>" with the "<code><a href="../basics/#identify">identify</a></code>" command.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre><code execute="" noimage="" out="fx_math.txt">
  magick identify -format '%[fx:atan(1)*4]' null:
</code></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_math.txt"><img src="fx_math.txt.gif" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This will mathematically calculate and return the value of <i>PI</i>, though this value is available as the built-in variable '<code>pi</code>'. You can generate random numbers. For example to generate an integer between -5 and 10 inclusive. Here I use the "<code><a href="../files/#info:">info:</a></code>" equivalent to the "<code>magick identify</code>" command.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre><code execute="" random="" out="fx_rand.txt">
  magick xc: -format '%[fx:int(rand()*16)-5]' info:
</code></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_rand.txt"><img src="fx_rand.txt.gif" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>For more methods see <a href="../basics/#identify_alt">Identify Alternatives: Text Output Options</a>. Also see <a href="../thumbnails/#rounded_border">Border with Rounded Corner</a> which used a <a href="https://imagemagick.org/script/fx.php">FX Expressions</a> to generate a draw string based on image width and height information. You can <a href="../layers/#layer_calc">Calculate Positions Images using FX formulas</a> or even position using the size and location of other images (See <a href="../layers/#layer_calc_inc">Incrementally Calculated Positions</a>). You can also use <a href="#fx_escapes">FX Escapes</a> in <a href="../files/#save_escapes">Filename Percent Escapes</a> to generate new files based on calculated values. For an example, see the final example in <a href="../crop/#crop_tile">Tile Cropping</a>.<br>
                <a name="fx_print" id="fx_print"></a> All the above will essentially run the "<code><a href="https://imagemagick.org/script/command-line-options.php?#format">-format</a></code>" and thus any containing <a href="https://imagemagick.org/script/fx.php">FX Expression</a> one for each image in the current image sequence. The "<code><a href="https://imagemagick.org/script/command-line-options.php?#print">-print</a></code>" operator will work much like "<code><a href="https://imagemagick.org/script/command-line-options.php?#identify">-identify</a></code>" except that it is only run once, with access to ALL the images in the current image sequence. With this operator you can use '<code>u[{i}]</code>' to access values from any image, unlike the above.<br>
                Fx Expressions can be applied to images in other colorspaces, so I can for example find out the 'Hue' value (in the 'red' channel) for three different colors.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre><code execute="" out="fx_hues.txt">
  magick xc:red xc:green xc:blue -colorspace HSL \
          -format '%[fx: s.r ]\n' info:
</code></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_hues.txt"><img src="fx_hues.txt.gif" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>You can also use IM for some direct color maths, such as find out the average color of '<code>gold</code>', '<code>yellow</code>', and '<code>khaki</code>'.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre><code execute="" out="pixel_math.txt">
  magick xc: -format '%[pixel:(gold+yellow+khaki)/3]' info:
</code></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="pixel_math.txt"><img src="pixel_math.txt.gif" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>While this shows what the color looks like compared to the three source colors...
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick xc:gold xc:yellow xc:khaki +append \
          \( xc: -fx '(gold+yellow+khaki)/3' \) \
          -scale 90x30\! -append fx_hues.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="fx_hues.png"><img src="fx_hues.png" width="90" height="60" align="middle" vspace="0" hspace="5" border="0" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>You can also use "<code><a href="https://imagemagick.org/script/command-line-options.php?#print">-print</a></code>" to print information. This is applied only once against the whole image sequence. That means you can use this operator to calculate much more complex '<code>%[fx:...]</code>' expressions involving multiple images. <a name="fx_other" id="fx_other"></a>
                <h4>Accessing data from other images</h4>There is one serious problem with using FX escaped expressions however. IM does not have direct access to the other images in the current image sequence when you are creating images. This is just generally not needed, in typical image creation, as new images generally do not depend on previous in-memory images. Basically if you want to gather the color of a specific pixel in a different image to the one you are drawing on (as above), or are creating a new image, then the IM core functions have no direct link to the desired info. For example if you try to create a label with the color of the built-in "<code>rose:</code>" image pixel 12,26 (a bluish pixel), the direct approach will fail!
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: label:'%[pixel:p{12,26}]' -delete 0 label_fx_direct.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="label_fx_direct.gif"><img src="label_fx_direct.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Well the rose image does not actually contain any black pixels, so the above result was wrong. The way to fix this is to extract the wanted information and save it into the global IM meta-data. This is passed to all sub-routines in the library core, including those for image creation.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -set option:mylabel '%[pixel:u.p{12,26}]' -delete 0 \
          label:'%[mylabel]'    label_fx_indirect.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="label_fx_indirect.gif"><img src="label_fx_indirect.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This is not intuitive but we now get the correct result. The special '<code>option:</code>' tag, tells the "<code><a href="https://imagemagick.org/script/command-line-options.php?#set">-set</a></code>" option that you want the given setting saved as a global <a href="../basics/#define">Artifact</a>, rather than as an image 'Attribute' or 'Properties' string, just as "<code><a href="https://imagemagick.org/script/command-line-options.php?#define">-define</a></code>" can. However the "<code><a href="https://imagemagick.org/script/command-line-options.php?#set">-set</a></code>" form allows you to expand <a href="../basics/#arg_percent">Percent Escapes</a> in setting the <a href="../basics/#define">Artifact</a>, where as "<code><a href="https://imagemagick.org/script/command-line-options.php?#define">-define</a></code>" does not. When the "<code>label:</code>" operator expands its percent escapes, the given 'key' is looked for first as a per image 'attribute' or 'proprieties', but if it fails to find anything, it will then look for the 'key' in the global <a href="../basics/#define">Artifact</a> settings. As such the global 'artifact' we created from the previous image is used, even though that image is no longer present at the time the <a href="../basics/#define">Artifact</a> was created. Basically 'Artifact' settings are global during the life time of the "<code>magick</code>" command, and thus can be used to pass information from one image to another. For programmed API's this situation can be avoided as you can read the required data directly from the image and generate the label string yourself, without needing IM to store that information in such a convoluted way.
                <hr>
                <!-- ---------------------------------------------------------------- -->
                <a name="evaluate" id="evaluate"></a>
                <h2>Evaluate and Function, Freeform Channel Modifiers</h2>Because the <a href="#fx">FX Operator</a> is an interpretted expression handler, the "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" operator was added to let you make simple image modifications more quickly. Later a more complex "<code><a href="https://imagemagick.org/script/command-line-options.php?#function">-function</a></code>" operator was added in IM v6.4.8-8, to allow greater flexibility in complex image adjustments. These two operators, along with other <a href="../color_mods/#levels">Image Level Adjustment Operators</a> such as "<code><a href="https://imagemagick.org/script/command-line-options.php?#negate">-negate</a></code>", "<code><a href="https://imagemagick.org/script/command-line-options.php?#level">-level</a></code>", will probably be most useful for minor tweaks to grey-scale images, before you apply those images. Especially in gray-scale images such as used for <a href="../masking/#bg_removal">Background Removal</a>, <a href="../transform/#shade_overlay">Highlight and Shadow Overlays</a>, and the generation and fine-tuning of <a href="../mapping/">Image Maps</a>.
                <h3>Evaluate, Simple Math Operations</h3>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" operator is basically a fast, but very simple version of "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" operator (actually pre-dates its addition to IM by just a couple of months). However it is limited to just one simple operation, using a single user provided constant number. You can find out what functions have been built into evaluate using
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick -list evaluate
</samp></pre>
                      </td>
                    </tr>
                  </table>
                </div>This includes the typical mathematical functions '<code>add</code>', '<code>subtract</code>', '<code>multiply</code>', and '<code>divide</code>'. against constant values. Unlike the <code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code> operator the values are not normalised to a 0 to 1 range, but remain the real color values of the image. As such subtracting a value of 50 in a Q8 IM (See <a href="../basics/#quality">Quality and Depth</a> will result in a large subtraction, but for a Q16 version of IM, it will only be a small hardly noticeable change. However if you add a '%' to the argument, that argument will represent a percentage of the maximum color value (known as '<code>QuantumRange</code>' which is equal to ('<code>2<sup><i>quality</i></sup>-1</code>'). This means you can make your "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" arguments IM quality level independent, by the appropriate use of percentages for the appropriate evaluate methods. <a name="evaluate_set" id="evaluate_set"></a> For example to just simply replace all color values in an image to a 50% gray level is very simple and very fast, using '<b><code>Set</code></b>'
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -evaluate set 50%  rose_set_gray.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="rose_set_gray.gif"><img src="rose_set_gray.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>The "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" operator also includes the typical mathematical functions '<code>add</code>', '<code>subtract</code>', '<code>multiply</code>', and '<code>divide</code>'. <a name="evaluate_divide" id="evaluate_divide"></a> <a name="evaluate_add" id="evaluate_add"></a> For example, to half the contrast of the image, you can '<b><code>divide</code></b>' it by '<code>2</code>' then '<b><code>add</code></b>' '<code>25%</code> to re-center it around a the perfect grey.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -evaluate divide 2 -evaluate add 25%  rose_de-constrast.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="rose_de-constrast.gif"><img src="rose_de-constrast.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This is a couple of orders of magnitude faster than directly using the "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" operator with '<code>u/2+.25</code>'. As such you should use this operator in preference to "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" if at all possible. The <i>major</i> problem with "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" is that all results are clipped to the 0 to '<code>QuantumRange</code>' limits (unless you are using a <a href="../basics/#hdri">HDRI version of ImageMagick</a>), as each modified value is saved back into the image data. That means that after any individual "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" operation, the values could be clipped by the '<code>QuantumRange</code>'. <a name="evaluate_multiply" id="evaluate_multiply"></a> As such if you try to apply a contrast enhancement function (equivalent to "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a> '2*u-.25'</code> ") directly as it stands, you will fail to get the correct results, as the doubled value will be clipped, before the subtraction is made.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -evaluate multiply 2  -evaluate subtract 25% \
          rose_contrast.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="rose_contrast.gif"><img src="rose_contrast.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>First the '<b><code>multiply</code></b>' will clip all the large color values to the maximum value, then the '<code>subtract</code>' will clip the lower bound values. the result is an incorrect clipping of the upper bounds, producing a dark and color distorted result. <a name="evaluate_subtract" id="evaluate_subtract"></a> The direct solution is to '<b><code>subtract</code></b>' the appropriate constant first (doing the final but correct clip of the lower bounds), before multiplying, effectively using the equivalent formula '<code>(u-.125)*2</code>'
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -evaluate subtract 12.5%  -evaluate multiply 2 \
          rose_contrast2.gif
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="rose_contrast2.gif"><img src="rose_contrast2.gif" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>However there are lots of alternatives to this 'clipping' problem. The first logical one being the newer <a href="#function_polynomial">Polynomial Function Method</a> (see below). Other alternatives also include using <a href="../color_mods/#level">Level Adjustment Operators</a> or even a <a href="../color_mods/#level-colors">Level Adjustment by Color</a>, to simply specify the original color values that you want to stretch out, to fill whole color range. Basically be careful with regards to color value clipping when using multiple "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" methods.<br>
                The "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" operator, like "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" (and most other low level IM operators) is "<code><a href="https://imagemagick.org/script/command-line-options.php?#channel">-channel</a></code>" effected. This allows you to control an images alpha transparency separately to the color channels. And yes, like "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>", transparency is treated as 'alpha values' and not a 'matte' value. For example to make an image 50% transparent, as part of a <a href="../compose/#dissolve">Dissolve</a> type operation.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick rose: -alpha set  -channel A -evaluate divide 2   rose_transparent.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="rose_transparent.png"><img src="rose_transparent.png" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>The result is a semi-transparent image, which means when displayed, half the color you see is the web-pages background color. As such the image shown is dimmed toward the background color. Often I have also found that it is often easier to use "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" on the individual color channels before separating the various channels into separate images for specific purposes, (See <a href="../color_basics/#separate">Separating Channels</a>). For example, here I use it to do a fast, but unusual form of gray-scaling. Basically I multiply each channel by the appropriate amount, then separate and add the channels together to produce an image that has been gray-scaled using a specific set of color ratios.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="justify">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick test.png -channel R -evaluate multiply .2 \
                   -channel G -evaluate multiply .5 \
                   -channel B -evaluate multiply .3 \
                   -channel RGB -separate -background black -compose plus -flatten gray_253.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <a href="grey_253.png"><img src="grey_253.png" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table><a name="evaluate_math" id="evaluate_math"></a>
                <h3>Evaluate Math Functions</h3>Included in Evaluate, there are also a set of special purpose mathematical functions. These functions are implemented to generally use a normalized color value (0 to 1 range) with the output again normalized so as to fit the full color range of the image. The <a href="../color_mods/#sigmoidal">Sigmoidal Contrast</a> function is also an example of this math function fitting. <a name="evaluate_pow" id="evaluate_pow"></a>
                <h4>Power Of</h4>The '<b><code>Pow</code></b>' function (added IM v6.4.1-9) for example works with normalized color values, and allows users to do image brightness modifications. It is exactly equivalent to the pow() C function, (using normalize color values in a 0 - 1 range)
                <pre>    value = pow(value, constant) </pre>As such to create a 'parabolic' gradient you can use an argument of '<code>2</code>'. Or use a value of '<code>0.5</code>' to create a 'square root' gradient. For example...
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick -size 20x600  gradient: -rotate 90  gradient.png
  magick gradient.png  -evaluate Pow  2   eval_pow_parabola.png
  magick gradient.png  -evaluate Pow 0.5  eval_pow_sq_root.png
</samp></pre>
                      </td>
                    </tr>
                  </table><a href="gradient.png"><img src="gradient.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="eval_pow_parabola.png"><img src="eval_pow_parabola.png" width="600" height="20" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a> <a href="eval_pow_sq_root.png"><img src="eval_pow_sq_root.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a><br>
                  <!-- <CODE EXECUTE>
  im_profile -s gradient.png  gradient_pf.gif
  im_profile -s eval_pow_parabola.png  eval_pow_parabola_pf.gif
  im_profile -s eval_pow_sq_root.png  eval_pow_sq_root_pf.gif
</CODE> -->
                   <a href="gradient_pf.gif"><img src="gradient_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="eval_pow_parabola_pf.gif"><img src="eval_pow_parabola_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="15" border="1" alt="[IM Output]"></a> <a href="eval_pow_sq_root_pf.gif"><img src="eval_pow_sq_root_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="15" border="1" alt="[IM Output]"></a>
                </div>
                <table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
                  <tr valign="top">
                    <td><img src="../img_www/reminder.gif" width="20" height="16"><img src="../img_www/space.gif" width="20" height="16"></td>
                    <td align="justify" width="100%"><font size="-1"><i>The three lower images show the profile of the gradient produced both a graph and the original image itself. This makes it easier to see how one gradient image was modified to become another. It was generated using the <a href="http://www.gnuplot.info/">Gnuplot</a> graph ploting program, via the script "<code><a href="../scripts/im_profile">im_profile</a></code>" in the IM Examples, <a href="../scripts/">Scripts</a> directory.</i></font></td>
                  </tr>
                </table>This is actually equivalent to the <a href="../color_mods/#gamma">Gamma Adjustment</a> operator but with the argument inverted. For example a "<code>-gamma 2</code>" operation would be equivalent to an "<code>-evaluate pow 0.5</code>" or a 'square root' operation function. Similarly "<code>-gamma 0.5</code>" is equivelent to squaring using "<code>-evaluate pow 2</code>"By doing some special gradient manipulations, you can use this method to magick a linear gradient into a complex circular arc.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick -size 20x300  gradient: -rotate 90 \
          -evaluate Pow 2 -negate -evaluate Pow 0.5 \
          -flop \( +clone -flop \) +append  eval_circle_arc.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="eval_circle_arc.png"><img src="eval_circle_arc.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s eval_circle_arc.png eval_circle_arc_pf.gif
</CODE> -->
                      <a href="eval_circle_arc_pf.gif"><img src="eval_circle_arc_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>For those wanting to figure this out, the second line in the above is equivelent to the <a href="#fx">FX expression</a> '<code>sqrt(1-u^2)</code>'. This generates a single quarter circle arc, which is then <a href="../warping/#flop">Flopped</a>, and <a href="../layers/#append">Appended</a> together, to produce a half circular arc. It is also a lot faster than using an <a href="#fx">FX expression</a>, even though it requires many more individual (smaller) steps. See also the more advanced <a href="#function_polynomial">Polynomial Function</a>. <a name="evaluate_log" id="evaluate_log"></a>
                <h4>Logrithmic</h4>The '<b><code>Log</code></b>' function (added IM v6.4.2-1) also works with normalized values (with a 1.0 added to avoid infinities), with the given constant being used as the logarithmic base. The actual formula (with normalized values) is thus...
                <pre>    value = log(value*constant+1.0)/log(constant+1.0) </pre>For example...
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -evaluate Log 10  eval_log.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="eval_log.png"><img src="eval_log.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s eval_log.png eval_log_pf.gif
</CODE> -->
                      <a href="eval_log_pf.gif"><img src="eval_log_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This may seem very simular to the previous <a href="#evaluate_pow">Pow Evaluate Method</a>, but it isn't quite the same. '<code>Log</code>' will produce an appreciable slope as it approaches '<code>0</code>', where '<code>Pow</code>' will produce a vertial slope. The value controls the slope. A logrithmic function is also closely related to an exponential function, which is currently only implemented as <a href="../color_mods/#sigmoidal-contrast">Sigmoidal Contrast Adjustment</a> operator. This contains the same slope features you can see in the above logrithmic curves. This explains why "<code><a href="https://imagemagick.org/script/command-line-options.php?#sigmoidal-contrast">-sigmoidal-contrast</a></code>" is a better technique for enhancing images involving low light conditions, than a <a href="../color_mods/#gamma">Gamma Adjustment</a> or 'power of' curve. <a name="evaluate_sin" id="evaluate_sin"></a> <a name="evaluate_cos" id="evaluate_cos"></a>
                <h4>Sine and Cosine</h4>As of IM v6.4.8-8 the '<b><code>sin</code></b>' and '<b><code>cos</code></b>' methods were added. These methods take the value given in the image and normalize it into an angle so the full range will cover a full circle of angles. The result is given a 50% bias and scaled to again fit into the normal range of values. The constant is used as a multiplier for the value (and thus the angle) so that 'N' means the function will go around the circle 'N' times over the full value range. Specifically it defines these function (using normalized values) as...
                <pre>   value = 0.5 * sin( constant*value*2*PI ) + 0.5
   value = 0.5 * cos( constant*value*2*PI ) + 0.5 </pre>In essence what these functions do is re-map the image values (usually gray-scale values) into a sine/cosine curve. For example, here I take a gradient image and modify it using these evaluate methods.
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png  -evaluate sin 1  eval_sin_1.png
  magick gradient.png  -evaluate cos 1  eval_cos_1.png
</samp></pre>
                      </td>
                    </tr>
                  </table><a href="eval_sin_1.png"><img src="eval_sin_1.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <a href="eval_cos_1.png"><img src="eval_cos_1.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a><br>
                  <!-- <CODE EXECUTE>
  im_profile -s eval_sin_1.png  eval_sin_1_pf.gif
  im_profile -s eval_cos_1.png  eval_cos_1_pf.gif
</CODE> -->
                   <a href="gradient_pf.gif"><img src="gradient_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="eval_sin_1_pf.gif"><img src="eval_sin_1_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <a href="eval_cos_1_pf.gif"><img src="eval_cos_1_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                </div>Now as the constant parameter is an angle multiplier, the value given to the evaluate method will create that many peaks over the whole gradient within an image.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -evaluate cos 5  -negate  eval_cos_5.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="eval_cos_5.png"><img src="eval_cos_5.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s eval_cos_5.png eval_cos_5_pf.gif
</CODE> -->
                      <a href="eval_cos_5_pf.gif"><img src="eval_cos_5_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This is perfect for many tasks, from generating ripple or dispersion effects to generate ripple looking displacement curves. By using a multiplier constant of '0.5' you can simply magick a linear gradient into a sine curve gradient, which still has the same slope as the original. By negating the result you can ensure that the gradient also slopes correctly.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -evaluate cos 0.5  -negate  eval_cos.5.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="eval_cos.5.png"><img src="eval_cos.5.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s eval_cos.5.png eval_cos.5_pf.gif
</CODE> -->
                      <a href="eval_cos.5_pf.gif"><img src="eval_cos.5_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Which is great generating smooth gradients for use in overlapping photos. However these last two "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" methods are rarely used as they have been superseded by a more general <a href="#function_sinusoid">Sinusoid Function</a> (see below) that provide more control options, beyond that of a simple frequency option.
                <hr>
                <!-- ---------------------------------------------------------------- -->
                <a name="function" id="function"></a>
                <h2>Function, Multi-Argument Evaluate</h2>The above wave generators proved to be extremely useful, especially with <a href="../mapping/#distort">Distortion Image Mapping</a>. But it was found that a much finer control of the functions was needed, requiring more than one parameter. Because of this the "<code><a href="https://imagemagick.org/script/command-line-options.php?#function">-function</a></code>" operator was added in IM v6.4.8-9. Basically "<code><a href="https://imagemagick.org/script/command-line-options.php?#function">-function</a></code>" is a multi-argument form of "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>". However unlike the <a href="#evaluate">Evaluate Operator</a>, these operators like the mathematical operators, all the functions above work only on normalised channel values (0.0 to 1.0 range) of the image, which in most cases makes them easier to use. <a name="function_polynomial" id="function_polynomial"></a>
                <h4>Polynomial Function</h4>The '<b><code>polynomial</code></b>' method will take any number of values, and will modify the color values in an image according the exact expression given, much faster than the <a href="#fx">FX Operator</a> can.
                <div align="center">
                  <pre>-function   Polynomial   a,b,c,...</pre>
                </div>Each value will be used as a coefficient from the highest order to the lowest, to produce a polynomial with the number of terms given. For example an argument of '<code>4,-4,1</code>' will generate the polynomial expression equivalent to the "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" expression " <code>4*u^2 - 4*u + 1</code> ". If you know your high school maths you should know then that this polynomial function produces a parabolic curve going from 1.0 to 0.0 then back to 1.0, over the input ('<code>u</code>') color range 0.0 to 1.0. That is, it will make, black and white colors 'white', and make perfect grays, 'black'.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Polynomial 4,-4,1  func_parabola.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_parabola.png"><img src="func_parabola.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_parabola.png func_parabola_pf.gif
</CODE> -->
                      <a href="func_parabola_pf.gif"><img src="func_parabola_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>You can even make a much more complex gradient, for example a quartic polynomial, which was the result of generating a <a href="../color_mods/#curves">Curve Level Adjustment</a>, using a set of 'level control points'. This is typically used to adjust the colors of an image to give it various shading effects.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Polynomial '-25, 53, -36, 8.3, 0.2' \
          func_quartic.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_quartic.png"><img src="func_quartic.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_quartic.png func_quartic_pf.gif
</CODE> -->
                      <a href="func_quartic_pf.gif"><img src="func_quartic_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Of course simple linear modification is also possible, exactly as you get if you used a <a href="../color_mods/#level">Level Operator</a>...
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Polynomial '4, -1.5' func_linear.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_linear.png"><img src="func_linear.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_linear.png func_linear_pf.gif
</CODE> -->
                      <a href="func_linear_pf.gif"><img src="func_linear_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Note however that you can not use '<code>Polynomial</code>' to do a full <a href="../quantize/#threshold">Threshold</a> operation, due to the need for infinite coefficients to do so, though you can get pretty close. A single value is naturally just a constant, and results in a direct assignment of that value. In other words it is just like the "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a> Set</code> " method, in this case to a 33% gray value.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Polynomial 0.33 func_constant.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_constant.png"><img src="func_constant.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_constant.png func_constant_pf.gif
</CODE> -->
                      <a href="func_constant_pf.gif"><img src="func_constant_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>By combining a '<code>Polynomial</code>' with other math functions you can create even more complex gradient modifications. For example by taking the square root of a polynomial, I can create a true circular arc over a linear gradient. The equivalent "<code><a href="https://imagemagick.org/script/command-line-options.php?#fx">-fx</a></code>" expression '<code>sqrt( -4*u^2 + 4*u + 0 )</code>'...
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Polynomial -4,4,0 -evaluate Pow 0.5 \
          func_circle_arc.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_circle_arc.png"><img src="func_circle_arc.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_circle_arc.png func_circle_arc_pf.gif
</CODE> -->
                      <a href="func_circle_arc_pf.gif"><img src="func_circle_arc_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>See also the <a href="#evaluate_pow">Pow Evaluate Method</a> for an alternative to the above. <a name="function_sinusoid" id="function_sinusoid"></a>
                <h4>Sinusoid Function</h4>The '<b><code>Sinusoid</code></b>' function method is a much more advanced version of the "<code><a href="https://imagemagick.org/script/command-line-options.php?#evaluate">-evaluate</a></code>" methods '<code>sin</code>' and '<code>cos</code>', and can in fact replicate those functions, but you have much better controls over how it modifies the color values in an image.
                <div align="center">
                  <pre>-function   Sinusoid   frequency,phase,amplitude,bias</pre>
                </div>And is implemented using the formula...
                <pre>  value = ampl * sin(2*PI( freq*value + phase/360 ) ) + bias</pre>This may seem complex but it ensures the function is easily to use. Only the first value 'frequency', which works exactly as per above, is required with all the other parameters being optional. By default it will generate a Sine Curve.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Sinusoid 1    func_sine.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_sine.png"><img src="func_sine.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_sine.png func_sine_pf.gif
</CODE> -->
                      <a href="func_sine_pf.gif"><img src="func_sine_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>By adding a '<i>phase</i>' argument in degrees, you can specify the starting angle for the curve. Allowing you magick the default sine curve into a cosine.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Sinusoid 1,90   func_cosine.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_cosine.png"><img src="func_cosine.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_cosine.png func_cosine_pf.gif
</CODE> -->
                      <a href="func_cosine_pf.gif"><img src="func_cosine_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>By adjusting the 'frequency', and 'phase' I can directly magick a linear gradient into a smooth sinusoidal gradient going from black to white (minimum to maximum along a Sine curve). See <a href="#evaluate_cos">Evaluate Cosine Method</a> for a less direct method.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Sinusoid 0.5,-90 func_sine_grad.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_sine_grad.png"><img src="func_sine_grad.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_sine_grad.png func_sine_grad_pf.gif
</CODE> -->
                      <a href="func_sine_grad_pf.gif"><img src="func_sine_grad_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>The next two optional values, 'amplitude' and 'bias' controls the scale and center-line of sinusoidal curve. For example, here I make a wave (negated cosine curve) that oscillates between white and gray (values ranging from <code>0.75 ±0.25</code>, or <code>0.5 to 1.0</code>), starting and finishing on white.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Sinusoid 5,90,.25,.75  func_sine_bias.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_sine_bias.png"><img src="func_sine_bias.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_sine_bias.png func_sine_bias_pf.gif
</CODE> -->
                      <a href="func_sine_bias_pf.gif"><img src="func_sine_bias_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Becareful with these last parameters as they could easy cause the waveform to exceed the bounds of the color value range, and thus be clipped (unless you are using a <a href="../basics/#hdri">HDRI version of ImageMagick</a>). <a name="function_arcsin" id="function_arcsin"></a>
                <h4>Arcsin Function</h4>The inverse sinusoid function '<b><code>Arcsin</code></b>' was added to IM v6.5.3-0. This is a special curve that was needed to generate a <a href="../mapping/#displace_cylinder">Cylindrical Displacement Map</a>. It parameters are...
                <div align="center">
                  <pre>-function   Arcsin   width,center,range,bias</pre>
                </div>And is implemented using the formula...
                <pre>  value = range/PI * asin(2/width*( value - center ) ) + bias</pre>By default values (if not defined) '<code>1, 0.5, 1, 0.5</code>' ensures the the function is centered so as to cover the whole color range from <code>0,0</code> to <code>1,1</code>.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arcsin 1    func_arcsin.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arcsin.png"><img src="func_arcsin.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arcsin.png func_arcsin_pf.gif
</CODE> -->
                      <a href="func_arcsin_pf.gif"><img src="func_arcsin_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>By halving the '<i>width</i>' of the resulting curve you get...
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arcsin 0.5    func_arcsin_width.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arcsin_width.png"><img src="func_arcsin_width.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arcsin_width.png func_arcsin_width_pf.gif
</CODE> -->
                      <a href="func_arcsin_width_pf.gif"><img src="func_arcsin_width_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>The '<i>center</i>' will let you reposition the curve according to the input grey values.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arcsin 0.4,0.7 func_arcsin_center.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arcsin_center.png"><img src="func_arcsin_center.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arcsin_center.png func_arcsin_center_pf.gif
</CODE> -->
                      <a href="func_arcsin_center_pf.gif"><img src="func_arcsin_center_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>The '<i>range</i>' argument allows to reduce the output range of the color values, and the '<i>bias</i>' will adjust the center of that range.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arcsin 0.5,0.5,0.5,0.5  func_arcsin_range.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arcsin_range.png"><img src="func_arcsin_range.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arcsin_range.png func_arcsin_range_pf.gif
</CODE> -->
                      <a href="func_arcsin_range_pf.gif"><img src="func_arcsin_range_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>Note how the values that are invalid as a result of the function are handled. This this allows better control when the function is used in displacements, and provides ways in which to clean them up. The actual values used are is '<code><i>bias</i> ±<i>range</i>/2</code>', as you would expect. Note that if either the '<i>width</i>' or the '<i>range</i>' are made negative the slope of the function will be flipped, as a result of that negative value.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arcsin -1    func_arcsin_neg.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arcsin_neg.png"><img src="func_arcsin_neg.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arcsin_neg.png func_arcsin_neg_pf.gif
</CODE> -->
                      <a href="func_arcsin_neg_pf.gif"><img src="func_arcsin_neg_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table><a name="function_arctan" id="function_arctan"></a>
                <h4>Arctan Function</h4>The '<b><code>Arctan</code></b>' method was added to IM v6.5.3-1. Its parameters are...
                <div align="center">
                  <pre>-function   Arctan   slope,center,range,bias</pre>
                </div>And is implemented using the formula...
                <pre>  value = range/PI * atan(slope*PI*( value - center ) ) + bias</pre>As you can see it is almost exactly the same as the 'Arcsin' function, with only a small change to make it more useful. It even has the same set of default values (if not defined) '<code>1, 0.5, 1.0, 0.5</code>'. This means that if you specify a slope value of '<code>1.0</code>' the slope of the histogram change will produce a 1:1 change around pure gray, (no scaling) while making white and black a more gray value. For example
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arctan 1 func_arctan.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arctan.png"><img src="func_arctan.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arctan.png func_arctan_pf.gif
</CODE> -->
                      <a href="func_arctan_pf.gif"><img src="func_arctan_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>That is, the middle part of the gradient is actually left unchanged, with only the black and white ends becoming de-contrasted. As the '<i>slope</i>' of the curve becomes larger, the gradient in the center will become stronger (more compressed in the middle), by that amount.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arctan 10 func_arctan_10.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arctan_10.png"><img src="func_arctan_10.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arctan_10.png func_arctan_10_pf.gif
</CODE> -->
                      <a href="func_arctan_10_pf.gif"><img src="func_arctan_10_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This in many ways is very similar to a <a href="../color_mods/#sigmoidal-contrast">Sigmoidal Contrast</a> color modification operator. However a '<code>Arctan</code>' function will NEVER actually reach the output range limits of pure black and white. It will approach those limits but never cross them. Similarly to the previous functions, (and <a href="../color_mods/#sigmoidal-contrast">Sigmoidal Contrast</a>) the second argument will adjust the position of the curve relative to the input gradient values.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arctan 10,.7 func_arctan_center.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arctan_center.png"><img src="func_arctan_center.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arctan_center.png func_arctan_center_pf.gif
</CODE> -->
                      <a href="func_arctan_center_pf.gif"><img src="func_arctan_center_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>And the last two arguments '<i>range</i>' will let you adjust output range of values that will be generated. For example by expanding this value slightly you can ensure that it will completely cover the whole range of possible values.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arctan 5,0.7,1.2 func_arctan_range.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arctan_range.png"><img src="func_arctan_range.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arctan_range.png func_arctan_range_pf.gif
</CODE> -->
                      <a href="func_arctan_range_pf.gif"><img src="func_arctan_range_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>However if you are really wanting to generate curve to modify the whole contrast of an image in this way, it is more typical to use the <a href="../color_mods/#sigmoidal-contrast">Sigmoidal Contrast Operator</a>, which is designed for this purpose. The more typical use of an '<code>Arctan</code>' gradient function to create a curve that will very quickly approach a specific value but not exceed that value. It is these limiting values that the '<i>range</i>' and '<i>bias</i>' arguments control. For example, this curve will modify the gradient in an image to produce very sharp threshold around the input gray level of 0.7, but with the values changing between the range limits of 0.5 and 1.0
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png -function Arctan 15,0.7,0.5,0.75 func_arctan_typ.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="func_arctan_typ.png"><img src="func_arctan_typ.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s func_arctan_typ.png func_arctan_typ_pf.gif
</CODE> -->
                      <a href="func_arctan_typ_pf.gif"><img src="func_arctan_typ_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This is something that <a href="../color_mods/#sigmoidal-contrast">Sigmoidal Contrast</a> can not generate.
                <hr>
                <!-- ---------------------------------------------------------------- -->
                <a name="gradient_math" id="gradient_math"></a>
                <h2>Mathematics on Gradient Images</h2>Now the above functions provide some very basic transformations for gradient images. But what if you want to do some mathematics with two or more gradient images. That is, modify one gradient using the gradient of another image. For this you need to use the special <a href="../compose/#math">Mathematical Compose Methods</a> (such as "<code><a href="../compose/#plus">Plus</a></code>" and "<code><a href="#divide">Divide</a></code>"). Before we start however, I would like to give you one <b>word of warning</b>. If your gradient images are purely grey-scale images, with no alpha channels, then you can use the <a href="../compose/#math">Mathematical Compose Methods</a> directly. However if you want to limit these methods to a specific channel, or apply them to the alpha (transparency) channel, then you need to ensure that you set the appropriate "<code><a href="https://imagemagick.org/script/command-line-options.php?#channel">-channel</a></code>" setting, with no special '<code>Sync</code>' channel flag. See <a href="../compose/#image_math">Image Mathematics using Image Composition</a> for more details. Normally using <a href="../compose/#math">Mathematical Compose Methods</a> is not really that difficult. The complications arise when you have gradients that also contain a 'bias'. That is, the gradient should represent a value of 'zero' at '50% grey, and cover a range from -1 (black) to +1 (white). Such images are often used for <a href="../mapping/#distort">Distortion Image Mapping</a>. As such performing maths on '<i>biased gradients</i>' is the real problem, and what will be looked at more specifically here. <a name="math_attenuate" id="math_attenuate"></a>
                <h3>Attenuate a Biased Gradient</h3>For example, here I want to create a sine wave, but one that starts out small, but then gets larger in amplitude. This known as 'attenuating' a biased gradient. Or putting it another way, multiply a biased gradient by another absolute gradient. It is also how '<i>Amplitude Modulation</i>' such as in AM radio works! So first we need a sine wave, which we can simply generate from a linear gradient...
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick -size 5x300 gradient: -rotate 90   math_linear.png
  magick math_linear.png  -evaluate sine 12  math_sine.png
</samp></pre>
                      </td>
                    </tr>
                  </table><!-- <CODE EXECUTE>
  im_profile -s math_linear.png math_linear_pf.gif
  im_profile -s math_sine.png   math_sine_pf.gif
</CODE> -->
                  <a href="math_linear_pf.gif"><img src="math_linear_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="math_sine_pf.gif"><img src="math_sine_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                </div>Now to attenuate this we multiply the sine wave with a linear gradient, using a <a href="../compose/#multiply">Multiply</a> alpha composition...
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick math_sine.png  math_linear.png  \
          -compose Multiply -composite  math_sine_2.png
</samp></pre>
                      </td>
                    </tr>
                  </table><!-- <CODE EXECUTE>
  im_profile -s math_sine_2.png   math_sine_2_pf.gif
</CODE> -->
                  <a href="math_sine_pf.gif"><img src="math_sine_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/multiply.gif" width="20" height="20" align="middle" alt="X"> <a href="math_linear_pf.gif"><img src="math_linear_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="math_sine_2_pf.gif"><img src="math_sine_2_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                </div>But to use this in say a <a href="../mapping/#water_ripples">Water Ripples, Displacement Map</a> the wave must remain centered around a perfect gray. To do this we need to add a bias to the original image. This happened to be the same function we used to multiply the original image, negated and divided by two....
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick math_linear.png -negate -evaluate divide 2  math_bias.png
  magick math_sine_2.png  math_bias.png \
          -compose Plus -composite  math_attenuated.png
</samp></pre>
                      </td>
                    </tr>
                  </table><!-- <CODE EXECUTE>
  im_profile -s math_bias.png   math_bias_pf.gif
  im_profile -s math_attenuated.png   math_attenuated_pf.gif
</CODE> -->
                  <a href="math_sine_2_pf.gif"><img src="math_sine_2_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" width="20" height="20" align="middle" alt="X"> <a href="math_bias_pf.gif"><img src="math_bias_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="math_attenuated_pf.gif"><img src="math_attenuated_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                </div>And so we have a linearly attenuated Sine Wave Gradient, suitable for use in a displacement map.
                <p>Of course you can do the whole process all in the one command, and it does not have to be a simple linear attenuation either. For example, here I attenuate the high frequency Sine wave, using a negated Cosine wave, instead of a linear gradient.</p>
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick math_linear.png  -evaluate cos 1 -negate  math_cosine_peak.png
  magick math_sine.png  math_cosine_peak.png \
          \( -clone 0,1 -compose multiply -composite \) \
          \( -clone  1  +level 50%,0 \
             -clone  2  -compose plus -composite \) \
          -delete 0--2  math_cosine_atten.png
</samp></pre>
                      </td>
                    </tr>
                  </table><!-- <CODE EXECUTE>
  im_profile -s math_cosine_peak.png   math_cosine_peak_pf.gif
  im_profile -s math_cosine_atten.png  math_cosine_atten_pf.gif
</CODE> -->
                  <a href="math_sine_pf.gif"><img src="math_sine_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <b>attenuate</b> <a href="math_cosine_peak_pf.gif"><img src="math_cosine_peak_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="math_cosine_atten_pf.gif"><img src="math_cosine_atten_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                </div>As of IM v6.5.4-3 it is now possible to do the all the steps above all in one compose method, using the special <a href="../compose/#mathematics">Mathematics Compose Method</a>. Basically by recognising that an attenuation operation is the formula <code>Sc*Dc-.5*Sc+.5</code> or the arguments, "<code>1,-.5,0,.5</code>".
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr valign="top">
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick math_sine.png  math_cosine_peak.png \
          -compose Mathematics -set option:compose:args 1,-.5,0,.5 \
          -composite  math_attenuate.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s math_attenuate.png  math_attenuate_pf.gif
</CODE> -->
                      <a href="math_attenuate_pf.gif"><img src="math_attenuate_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>The same result can also be achieved by first adjusting the attenuation gradient using a <a href="#function_polynomial">Polynomial Function</a> and then using a <a href="../compose/#exclusion">Exclusion</a> compose operator, to merge the images.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr valign="top">
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick math_sine.png \( math_cosine_peak.png -function polynomial -.5,.5 \) \
          -compose Exclusion -composite  math_poly_excl.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s math_poly_excl.png  math_poly_excl_pf.gif
</CODE> -->
                      <a href="math_poly_excl_pf.gif"><img src="math_poly_excl_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table><a name="math_multiply" id="math_multiply"></a>
                <h3>Multiply Biased Gradients</h3>But what if BOTH functions are biased so a perfect gray means zero, and black and white represent the range from -1 to +1? Well this is a little more complex as you can't just multiply them and expect it to come out right, as the multiplication can consist of a negative values. This requires some care so as to ensure you don't end up clipping the values and getting the right negation of the curve in the resulting image. The trick is to break up the multiplication into multiple steps. That is &nbsp; <b><code>A × B</code></b> &nbsp; can also be written as &nbsp; <b><code>A × abs(B) × sign(B)</code></b>. By doing this you avoid multiplying by a negative value, which can't be stored in a normal gradient image. So all we need to do is take one of the bias gradients and separate it into two parts so they can be applied to the other gradient appropriately. The '<code>sign()</code>' of a biased gradient, or getting a mask of what parts are negative, can get extracted by using a <a href="../quantize/#threshold">Threshold</a> on the gradient at the bias level. You can later selectively negate the other gradient using a <a href="../compose/#difference">Composite Difference</a>, with that threshold image. The '<code>abs()</code>' of a biased gradient can be extracted easily using <a href="../color_mods/#solarize">Solarize</a>, then negating and doubling (using <a href="../color_mods/#level">Level</a>) that to get the absolute value of the gradient ranging from 0.0 to 1.0. As we will also need the bias offset as part of the multiply (as per <a href="#math_attenuate">Attenuate</a> above), you can directly use the negated and half-scaled solarize output, before it is converted into the gradients absolute value. So lets magick one gradient into these three components.
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick math_cosine_peak.png  -threshold 50% -negate  math_m_sign.png
  magick math_cosine_peak.png     -solarize 50%        math_m_bias.png
  magick math_m_bias.png          -level 50%,0         math_m_abs.png
</samp></pre>
                      </td>
                    </tr>
                  </table><!-- <CODE EXECUTE>
  im_profile -s math_m_sign.png  math_m_sign_pf.gif
  im_profile -s math_m_bias.png  math_m_bias_pf.gif
  im_profile -s math_m_abs.png   math_m_abs_pf.gif
</CODE> -->
                  <table>
                    <tr>
                      <td></td>
                      <td>
                        <a href="math_m_sign_pf.gif"><img src="math_m_sign_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                      </td>
                      <td align="center">Sign of Gradient<br>
                      white = negative</td>
                    </tr>
                    <tr>
                      <td>
                        <a href="math_cosine_peak_pf.gif"><img src="math_cosine_peak_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;">
                      </td>
                      <td>
                        <a href="math_m_bias_pf.gif"><img src="math_m_bias_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                      </td>
                      <td align="center">Bias Offset</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td>
                        <a href="math_m_abs_pf.gif"><img src="math_m_abs_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                      </td>
                      <td align="center">Absolute Value</td>
                    </tr>
                    <tr>
                      <td></td>
                    </tr>
                  </table>
                </div>Now that we have these three parts of one of the gradient images, we can merge them with the other gradient. To do this we multiply by the absolute value, re-add the bias, and then negate the parts that should be made negative.
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick math_sine.png   math_m_abs.png \
          -compose Multiply -composite    math_m_1.png
  magick math_m_1.png   math_m_bias.png \
          -compose Plus -composite        math_m_2.png
  magick math_m_2.png   math_m_sign.png \
          -compose Difference -composite  math_multiply.png
</samp></pre>
                      </td>
                    </tr>
                  </table><!-- <CODE EXECUTE>
  im_profile -s math_m_1.png  math_m_1_pf.gif
  im_profile -s math_m_2.png  math_m_2_pf.gif
  im_profile -s math_multiply.png   math_multiply_pf.gif
</CODE> -->
                  <table>
                    <tr>
                      <td>
                        <a href="math_sine_pf.gif"><img src="math_sine_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                      </td>
                      <td><img src="../img_www/multiply.gif" width="20" height="20" align="middle" alt="X"></td>
                      <td>
                        <a href="math_m_abs_pf.gif"><img src="math_m_abs_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="math_m_1_pf.gif"><img src="math_m_1_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                      </td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><img src="../img_www/plus.gif" width="20" height="20" align="middle" alt="+"></td>
                      <td>
                        <a href="math_m_bias_pf.gif"><img src="math_m_bias_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="math_m_2_pf.gif"><img src="math_m_2_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                      </td>
                    </tr>
                    <tr>
                      <td></td>
                      <td>sign</td>
                      <td>
                        <a href="math_m_sign_pf.gif"><img src="math_m_sign_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="math_multiply_pf.gif"><img src="math_multiply_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="15" border="1" alt="[IM Output]"></a>
                      </td>
                    </tr>
                    <tr>
                      <td></td>
                    </tr>
                  </table>
                </div>And that is a perfect multiplication of two bias gradient images! Here it is again but all in the one command...
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick math_sine.png  math_cosine_peak.png \
          \( -clone  1  -threshold 50% -negate \) \
          \( -clone  1      -solarize 50%      \) \
          \( -clone  3      -level 50%,0       \) \
          \( -clone 0,4 -compose multiply   -composite \
             -clone  3  -compose plus       -composite \
             -clone  2  -compose difference -composite \) \
          -delete 0--2    math_multiply_2.png
</samp></pre>
                      </td>
                    </tr>
                  </table><!-- <CODE EXECUTE>
  im_profile -s math_multiply_2.png  math_multiply_2_pf.gif
</CODE> -->
                  <a href="math_sine_pf.gif"><img src="math_sine_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/multiply.gif" width="20" height="20" align="middle" alt="X"> <a href="math_cosine_peak_pf.gif"><img src="math_cosine_peak_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="math_multiply_2_pf.gif"><img src="math_multiply_2_pf.gif" width="150" height="100" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                </div>One final note, unlike <a href="#attenuation">Attenuation</a>, this Multiply of biased gradients is commutative. That is, swapping the input images does not effect the final result. As the above is equivelent to the formula <code>2*Sc*Dc-Sc-Dc+1</code>, as of IM v6.5.4-3, you can implement the above complex steps as a single '<code><a href="../compose/#mathematics">Mathematics</a></code>' compose method using the argument "<code>2,-1,-1,1</code>".
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr valign="top">
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick math_sine.png  math_cosine_peak.png \
          -compose Mathematics -set option:compose:args 2,-1,-1,1 \
          -composite  math_bias_multiply.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s math_bias_multiply.png  math_bias_multiply_pf.gif
</CODE> -->
                      <a href="math_bias_multiply_pf.gif"><img src="math_bias_multiply_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>That is, vastly easier and faster method than the dozen or more steps needed without this argumented compose method. It so happens that once I saw that formula, I realised that this happens to be simply the negation of the '<code><a href="../compose/#exclusion">Exclusion</a></code>' compose method. Weird but true. As such the following will also generate the same zero baised multiply.
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr valign="top">
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick math_sine.png  math_cosine_peak.png \
          -compose exclusion -composite -negate  math_excl_neg.png
</samp></pre>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s math_excl_neg.png  math_excl_neg_pf.gif
</CODE> -->
                      <a href="math_excl_neg_pf.gif"><img src="math_excl_neg_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table><a name="math_addition" id="math_addition"></a>
                <h3>Adding Biased Gradients</h3>With the advent of the '<code><a href="../compose/#mathematics">Mathematics</a></code>' compose method, adding biased gradients is also relativally easy. The equivelent FX formula is "<code>u+v-0.5</code>" or a compose argument of "<code>0,1,1,-.5</code>". For example the following was a <a href="../fourier/#waves">Fourier Transform Example</a> that I had hand generated, requiring the addition of 3 biased sinusoids, and a constant DC value.
                <div align="center">
                  <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="90%" bgcolor="#F8F8F8">
                    <tr>
                      <td>
                        <pre class="bg-light text-dark mx-4"><samp>
  magick math_linear.png -function sinusoid 3.5,0,.25     wave_1.png
  magick math_linear.png -function sinusoid 1.5,-90,.13   wave_2.png
  magick math_linear.png -function sinusoid 0.6,-90,.07   wave_3.png

  magick wave_1.png wave_2.png wave_3.png -background gray40 \
          -compose Mathematics -set option:compose:args 0,1,1,-.5 \
          -flatten  added_waves.png
</samp></pre>
                      </td>
                    </tr>
                  </table><!--<CODE EXECUTE>
  im_profile -s wave_1.png wave_1_pf.gif
  im_profile -s wave_2.png wave_2_pf.gif
  im_profile -s wave_3.png wave_3_pf.gif
  im_profile -s added_waves.png added_waves_pf.gif
</CODE>-->
                  <a href="wave_1_pf.gif"><img src="wave_1_pf.gif" width="150" height="100" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" width="20" height="20" align="middle" alt=" + "> <a href="wave_2_pf.gif"><img src="wave_2_pf.gif" width="150" height="100" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/plus.gif" width="20" height="20" align="middle" alt=" + "> <a href="wave_3_pf.gif"><img src="wave_3_pf.gif" width="150" height="100" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a> <img src="../img_www/right.gif" width="20" height="20" align="middle" alt="==&gt;"> <a href="added_waves_pf.gif"><img src="added_waves_pf.gif" width="150" height="100" align="middle" vspace="2" hspace="5" border="1" alt="[IM Output]"></a>
                </div>Note in the above how I used the "<code><a href="https://imagemagick.org/script/command-line-options.php?#flatten">-flatten</a></code>" operator with a "<code><a href="https://imagemagick.org/script/command-line-options.php?#background">-background</a></code>" setting to implement a mutliple image composition. Or in this case a 'Biased Sum' of all the given images plus the background constant. <a name="math_freq_mod" id="math_freq_mod"></a>
                <h3>Frequency Modulation</h3>By applying a function directly to the output of another function, you do NOT produce a simple result. The reason is that all these math functions are applied to the gradient 'value' of individual pixels, and not against the x value of the pixel in the gradient. For example....
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr>
                    <td width="100%" align="center">
                      <table class="table table-sm table-hover table-striped" cellspacing="0" cellpadding="5" width="100%" bgcolor="#F8F8F8">
                        <tr>
                          <td>
                            <pre class="bg-light text-dark mx-4"><samp>
  magick gradient.png  -evaluate sin 0.5 -normalize \
                        -evaluate cos  8  math_cos_var.png
</samp></pre>
                          </td>
                        </tr>
                      </table><a href="math_cos_var.png"><img src="math_cos_var.png" width="600" height="20" align="middle" vspace="5" hspace="5" border="1" alt="[IM Output]"></a>
                    </td>
                    <td>
                      <!-- <CODE EXECUTE>
  im_profile -s math_cos_var.png math_cos_var_pf.gif
</CODE> -->
                      <a href="math_cos_var_pf.gif"><img src="math_cos_var_pf.gif" width="150" height="100" align="middle" vspace="0" hspace="2" border="1" alt="[IM Output]"></a>
                    </td>
                  </tr>
                </table>This generates a very complex function that is essentually equivelent to
                <div align="center">
                  <code>cos( 8 * sin( <i>{value}</i>/2 ) )</code>
                </div>In other words a variable frequency, where the frequency varies with the gradient of the first sine curve. Basically the faster the gradient changes in the original image, the smaller the distance between the peaks. However the height (amplitude) of the peak do not vary. This is actually how '<i>Frequency Modulation</i>' works, where a seemingly simple function produces a very complex result.
                <hr>
                <!-- ---------------------------------------------------------------- -->
                <div align="center">
                  <font size="+2"><b><img src="../img_www/const_barrier.gif" width="39" height="35" align="top"> Under Construction <img src="../img_www/const_hole.gif" width="144" height="50" align="middle"></b></font>
                </div>
                <pre>
Miscellaneous Image Transformation Techniques.

These have not been exampled yet, but are some basic IM developed transforms
that may provide useful.  If you have an interesting effect please contribute.

   pixelize an image
      resize an image down 10 then scale the image 10 to produce blocks
      of roughly averaged color.
      For example...
         magick input.jpg -resize 10% -sample 1000% output.jpg

  De-skew slightly rotated images

    -deskew {threshold}
       straighten an image. A threshold of 40% works for most images.

    Use -set option:deskew:auto-crop {width} to auto crop the image. The set
    argument is the pixel width of the image background (e.g 40).

    Programmically we auto crop by running a median filter across the image
    to eliminate salt-n-pepper noise.  Next we get the image bounds of the
    median filter image with a fuzz factor (e.g. -fuzz 5%).  Finally we
    crop the original image by the bounds.  The code looks like this:

      median_image=MedianFilterImage(image,0.0,exception);
      geometry=GetImageBoundingBox(median_image,exception);
      median_image-DestoryImage(median_image);

      print("  Auto-crop geometry: %lux%lu%+ld%+ld",
                geometry.width,geometry.height, geometry.x,geometry.y);
      crop_image=CropImage(rotate_image,&amp;geometry,exception);

    See <a href="../crop/#trim_blur">Trimming 'Noisy' Images</a>

  Segmentation
    look at scripts
       <a href="../scripts/divide_vert">divide_vert</a>
       <a href="../scripts/segment_image">segment_image</a>
    for some simple scripts I wrote to segment well defined images into
    smaller parts.   I hope to get simple segmentation functions like this
    into the core library, to allow for things like automatic sub-division of
    GIF animations, and seperating images and diagrams from scanned documents.


</pre>
                <hr>
                <!-- ---------------------------------------------------------------- -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer class="magick-footer">
    <div class="container-fluid">
      Created: 15 March 2004<br>
      Updated: 18 June 2009<br>
      Author: <a href="https://antofthy.gitlab.io/anthony.html">Anthony Thyssen</a>, &lt;Anthony.Thyssen@gmail.com&gt;<br>
      Examples Generated with: <img src="version.gif" align="absmiddle" alt="[version image]"><br>
      URL: <code>https://usage.imagemagick.org/transform/</code>
    </div>
  </footer>
</body>
</html>
